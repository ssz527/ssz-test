/**
 * hdmap 3.0.24
 * hdmap is a web GIS engine using openlayers 4.5
 *
 * Copyright 2017
 * Released under the ISC license.
*/

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("myopenlayers"),require("perfect-scrollbar")):"function"==typeof define&&define.amd?define(["myopenlayers","perfect-scrollbar"],t):e.hdmap=t(null,e.PerfectScrollbar)}(this,function(e,t){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;var o="[mapEngine warn]",r="[mapEngine info]";var a=function(e){return function(t,o,r){var a,n=t.length,i=r||2;a=o||(2!==i?t.slice():new Array(n));for(var s=0;s<n;s+=i)e(t,a,s);return a}},n={},i=Math.PI/180;n.forward=a(function(e,t,o){var r=Math.max(Math.min(85.0511287798,e[o+1]),-85.0511287798),a=Math.sin(r*i);t[o]=6378137*e[o]*i,t[o+1]=6378137*Math.log((1+a)/(1-a))/2}),n.inverse=a(function(e,t,o){t[o]=e[o]/6378137/i,t[o+1]=(2*Math.atan(Math.exp(e[o+1]/6378137))-Math.PI/2)/i});var s={},l=[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0],p=[75,60,45,30,15,0],u=[[1.410526172116255e-8,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,17337981.2],[-7.435856389565537e-9,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,10260144.86],[-3.030883460898826e-8,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,6856817.37],[-1.981981304930552e-8,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,4482777.06],[3.09191371068437e-9,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,2555164.4],[2.890871144776878e-9,8983055095805407e-21,-3.068298e-8,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]],c=[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[.0008277824516172526,111320.7020463578,647795574.6671607,-4082003173.641316,10774905663.51142,-15171875531.51559,12053065338.62167,-5124939663.577472,913311935.9512032,67.5],[.00337398766765,111320.7020202162,4481351.045890365,-23393751.19931662,79682215.47186455,-115964993.2797253,97236711.15602145,-43661946.33752821,8477230.501135234,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-.0003441963504368392,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-.0003218135878613132,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]];function h(e,t,o,r){var a=e[o],n=e[o+1],i=r[0]+r[1]*Math.abs(a),s=Math.abs(n)/r[9],l=r[2]+r[3]*s+r[4]*s*s+r[5]*s*s*s+r[6]*s*s*s*s+r[7]*s*s*s*s*s+r[8]*s*s*s*s*s*s;t[o]=i*(a<0?-1:1),t[o+1]=l*(n<0?-1:1)}s.forward=a(function(e,t,o){var r,a,n,i,s=function(e,t,o){for(var r=o-t;e>o;)e-=r;for(;e<t;)e+=r;return e}(e[o],-180,180),l=(r=e[o+1],a=-74,n=74,r=Math.max(r,a),r=Math.min(r,n)),u=null;for(i=0;i<p.length;++i)if(l>=p[i]){u=c[i];break}if(null===u)for(i=p.length-1;i>=0;--i)if(l<=-p[i]){u=c[i];break}t[o]=s,t[o+1]=l,h(t,t,o,u)}),s.inverse=a(function(e,t,o){for(var r=Math.abs(e[o+1]),a=null,n=0;n<l.length;n++)if(r>=l[n]){a=u[n];break}h(e,t,o,a)});var d={},y=Math.PI,f=6378245,m=.006693421622965943;function g(e,t){var o=function(e,t){var o=2*e-100+3*t+.2*t*t+.1*e*t+.2*Math.sqrt(Math.abs(e));return o+=2*(20*Math.sin(6*e*y)+20*Math.sin(2*e*y))/3,o+=2*(20*Math.sin(t*y)+40*Math.sin(t/3*y))/3,o+=2*(160*Math.sin(t/12*y)+320*Math.sin(t*y/30))/3}(e-105,t-35),r=function(e,t){var o=300+e+2*t+.1*e*e+.1*e*t+.1*Math.sqrt(Math.abs(e));return o+=2*(20*Math.sin(6*e*y)+20*Math.sin(2*e*y))/3,o+=2*(20*Math.sin(e*y)+40*Math.sin(e/3*y))/3,o+=2*(150*Math.sin(e/12*y)+300*Math.sin(e/30*y))/3}(e-105,t-35),a=t/180*y,n=Math.sin(a);n=1-m*n*n;var i=Math.sqrt(n);return o=180*o/(f*(1-m)/(n*i)*y),[r=180*r/(f/i*Math.cos(a)*y),o]}function v(e,t){return e<72.004||e>137.8347||(t<.8293||t>55.8271)}d.toWGS84=a(function(e,t,o){var r=e[o],a=e[o+1];if(!v(r,a)){var n=g(r,a);r-=n[0],a-=n[1]}t[o]=r,t[o+1]=a}),d.fromWGS84=a(function(e,t,o){var r=e[o],a=e[o+1];if(!v(r,a)){var n=g(r,a);r+=n[0],a+=n[1]}t[o]=r,t[o+1]=a});var w={},_=3e3*y/180;function S(e,t,o){var r=e[o]-.0065,a=e[o+1]-.006,n=Math.sqrt(r*r+a*a)-2e-5*Math.sin(a*_),i=Math.atan2(a,r)-3e-6*Math.cos(r*_);return t[o]=n*Math.cos(i),t[o+1]=n*Math.sin(i),t}function L(e,t,o){var r=e[o],a=e[o+1],n=Math.sqrt(r*r+a*a)+2e-5*Math.sin(a*_),i=Math.atan2(a,r)+3e-6*Math.cos(r*_);return t[o]=n*Math.cos(i)+.0065,t[o+1]=n*Math.sin(i)+.006,t}w.toWGS84=function(e,t,o){var r=a(S)(e,t,o);return d.toWGS84(r,r,o)},w.fromWGS84=function(e,t,o){var r=d.fromWGS84(e,t,o);return a(L)(r,r,o)};var b={};b.smerc2bmerc=function(e,t,o){var r=n.inverse(e,t,o);return r=w.fromWGS84(r,r,o),s.forward(r,r,o)},b.bmerc2smerc=function(e,t,o){var r=s.inverse(e,t,o);return r=w.toWGS84(r,r,o),n.forward(r,r,o)},b.bmerc2ll=function(e,t,o){var r=s.inverse(e,t,o);return w.toWGS84(r,r,o)},b.ll2bmerc=function(e,t,o){var r=w.fromWGS84(e,t,o);return s.forward(r,r,o)},b.ll2smerc=n.forward,b.smerc2ll=n.inverse;var T=[72.004,.8293,137.8347,55.8271],M=new ol.proj.Projection({code:"baidu",extent:ol.extent.applyTransform(T,b.ll2bmerc),units:"m"});ol.proj.addProjection(M),ol.proj.addCoordinateTransforms("EPSG:4326",M,b.ll2bmerc,b.bmerc2ll),ol.proj.addCoordinateTransforms("EPSG:3857",M,b.smerc2bmerc,b.bmerc2smerc);for(var x=new Array(19),C=0;C<19;++C)x[C]=Math.pow(2,18-C);function P(e,t){return e.eventCallback[t].default}function k(e){return hdmap.mapManager[e.map.ol_uid]}var F=0,E={singleclick:function(e){var t=k(e);if(t.closeCommonPopup(),!t.getDrawLineState()){var o=e.map.forEachFeatureAtPixel(e.pixel,function(e,t){return e}),r=P(t,"singleclick");if(o){var a=hdmap.utils.getFeaturesInExtent(t,e.coordinate);if((a=a.filter(function(e){return e.imgUrl&&"car"!==e.markerType})).length>1&&o instanceof ol.DevFeature)return void t.popupMultipoint(e.coordinate,a);if(o instanceof ol.DevFeature||o instanceof ol.AreaFeature||o instanceof ol.LineFeature||o instanceof ol.CountFeature){var n=o.extProperties.markerType;""===o.extProperties.markerType&&(n="common");var i=t.eventCallback.singleclick[n],s={feature:o.extProperties,eventType:"singleclick",coordinate:e.coordinate,layerKey:o.layerKey,mapEvent:e};i?i.call(this,s):null!==r&&r.call(this,s)}}else null!==r&&r.call(this,{feature:null,eventType:"singleclick",coordinate:e.coordinate,layerKey:null,mapEvent:e})}},selected:function(e){var t=k(e);if(t.getDragState()){var o=e.map.forEachFeatureAtPixel(e.pixel,function(e,t){return e});null!==t.eventCallback.selected.default&&t.eventCallback.selected.default.call(this,{feature:o,eventType:"selected",coordinate:e.coordinate})}},cancelSelected:function(e){var t=k(e);if(t.getDragState()){var o=e.map.forEachFeatureAtPixel(e.pixel,function(e,t){return e});null!==t.eventCallback.cancelSelected.default&&t.eventCallback.cancelSelected.default.call(this,{feature:o,eventType:"cancelSelected",coordinate:e.coordinate})}},pointermove:function(e){var t=k(e),o=t.getLayerByKey("gisLayer"),r=P(t,"pointermove");if(o){var a=o.getSource().getFeaturesAtCoordinate(e.coordinate);if(a.length>0){if(!a[0].extProperties.visible){a[0].setStyle(hdmap.commonConfig.getMouseOverAreaStyle());for(var n=o.getSource().getFeatures(),i=0;i<n.length;i++)n[i].extProperties.visible||n[i].extProperties.id===a[0].extProperties.id||n[i].setStyle(null)}r&&r.call(this,{feature:a[0],eventType:"pointermove",coordinate:e.coordinate})}else{for(var s=o.getSource().getFeatures(),l=0;l<s.length;l++)s[l].extProperties.visible||s[l].setStyle(null);r&&r.call(this,{feature:a[0],eventType:"pointermove",coordinate:e.coordinate})}}else r&&r.call(this,{feature:null,eventType:"pointermove",coordinate:e.coordinate})},zoomChange:function(e){var t=hdmap.mapManager[this.ol_uid],o=P(t,"zoomChange"),r=t.getZoom(),a=parseInt(r);if(F!==a){F=a;var n=t.outterLayers;for(var i in n){var s=n[i],l=s.layerKey,p=l.split("_");p[1]&&(F>=parseInt(p[1])&&s.getVisibleFlag()?t.setLayerVisible(l,!0):t.setLayerVisible(l,!1))}}null!==o&&o.call(this,{zoom:r,eventType:"zoomChange"})},movestart:function(e){var t=P(k(e),"movestart");null!==t&&t.call(this,{eventType:"movestart"})},moveend:function(e){var t=P(k(e),"moveend");null!==t&&t.call(this,{eventType:"moveend"})}},I={camera:"cameraLayer",video:"videoLayer",guarder:"guarderLayer",cleaner:"cleanerLayer",car:"carLayer",warning:"warningLayer",common:"commonLayer",gis:"gisLayer",line:"lineLayer",fence:"fenceLayer",countCamera:"countCameraLayer",countWarning:"countWarningLayer",countBroadcast:"countBroadcastLayer",countCameraBase:"cameraBase",countWarningBase:"warningBase",countBroadcastBase:"broadcastBase",robot:"robotLayer",signpost:"signpostLayer",broadcast:"broadcastLayer",warnMarker:"warnMarkerLayer",households:"householdsLayer",visitor:"visitorLayer",stranger:"strangerLayer",control:"controlLayer",brake:"brakeLayer",gates:"gatesLayer",elevator:"elevatorLayer",lock:"lockLayer"};var B={getLayerKeyByType:function(e,t){return t?e+"Layer_"+t:I[e]?I[e]:I.common},getLayerMap:function(){return I}},K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},D={curZIndex:1,curPopNum:0,reset:function(){0===this.curPopNum&&(this.curZIndex=1)},setPopupZIndex:function(e){this.curZIndex++,document.getElementById(e+"-wrapper").style.zIndex=this.curZIndex}},z=null;function A(e){this.controlZoom=!0,this.dragPan=!0,this.attribution=!1,!1===e.controlZoom&&(this.controlZoom=!1),!1===e.dragPan&&(this.dragPan=!1),!0===e.attribution&&(this.attribution=!0),this._map=null,this.layers=[],this._overlay=null,this.popup_container=null,this.popup_closer=null,this.popup_content=null,this.popup_contentWrap=[],this.popup_closestatus=!1,this._overlays=[],this._warnOverlays=[],this._viewOverlay={},this.areaTimer={},this.lineTimer={},this._outPopupWarp="hdmap-outterPopup",this.mapResolutions=[],this.outterLayers={},this.eventCallback={singleclick:{default:null},selected:{default:null},cancelSelected:{default:null},pointermove:{default:null},pointerdrag:{default:null},zoomChange:{default:null},movestart:{default:null},moveend:{default:null}},this.eventKey={},this.drawTool={},this.mapConfig={},this.dragFeatureTool={},this.mapInit(e),hdmap.mapManager[this.getMapUid()]=this,this.regDefaulEventCallback()}A.prototype.mapInit=function(e){!1!==function(e){if(e.popupDom||(e.popupDom={popup:e.domId+"-popup",popupcloser:e.domId+"-popup-closer",popupcontent:e.domId+"-popup-content"}),e.arcAngle||(e.arcAngle=0),e.scale||(e.scale=1),e.scaleType||(e.scaleType=0),e.gisEngine){if("baidu"===e.gisEngine)e.mapUrl=e.sat?hdmap.commonConfig.gisConfig.mapSatUrl:hdmap.commonConfig.gisConfig.mapUrl,e.satUrl=hdmap.commonConfig.gisConfig.SatUrl;else if("bitmap"===e.gisEngine){if(!e.mapUrl)return console.warn(o+"bitmap without picture url"),!1;if(!e.sizeH||!e.sizeW)return console.warn(o+"bitmap without size of the picture"),!1}else if("tile"===e.gisEngine){if(!e.mapUrl)return console.warn(o+"tilemap param without tile service url"),!1;if(!e.sizeH||!e.sizeW)return console.warn(o+"tilemap param without extent of the map"),!1;if(!e.centerGPS)return console.warn(o+"tilemap param without centerGPS"),!1;void 0===e.maxZoom&&(e.maxZoom=6),void 0===e.minZoom&&(e.minZoom=0),e.zoom||(e.zoom=2),(!e.rangeCoefficient||e.rangeCoefficient<1)&&(console.warn(o+"illegal rangeCoefficient, will use default value 2"),e.rangeCoefficient=2),e.mapMaxResolution||(console.warn(o+"illegal mapMaxResolution, will use default value 1"),e.mapMaxResolution=1),void 0===e.tileMinZoom&&(console.warn(o+"illegal tileMinZoom, will set options.minZoom to tileMinZoom"),e.tileMinZoom=e.minZoom),void 0===e.tileMaxZoom&&(console.warn(o+"illegal tileMaxZoom, will set options.maxZoom to tileMaxZoom"),e.tileMaxZoom=e.maxZoom),e.moveTolerance&&"number"==typeof e.moveTolerance||(e.moveTolerance=5)}}else e.gisEngine="baidu",e.mapUrl=hdmap.commonConfig.gisConfig.mapUrl,e.center=hdmap.commonConfig.gisConfig.center;return!0}(e)&&(this.copyAttr(this.mapConfig,e),this.popupInit(e.popupDom),"baidu"===e.gisEngine?this.initBaiduMap(e):"bitmap"===e.gisEngine?this.initBitmap(e):"gaode"===e.gisEngine?this.initGaodeMap(e):"tile"===e.gisEngine&&this.initTileMap(e))},A.prototype.initTileMap=function(e){for(var t=[0,-e.sizeH,e.sizeW,0],o=e.minZoom,r=e.maxZoom,a=e.tileMinZoom,n=e.tileMaxZoom,i=e.mapMaxResolution,s=[0,-e.sizeH,e.sizeW,0],l=0;l<=n;l++)this.mapResolutions.push(Math.pow(2,n-l)*i);var p=new ol.tilegrid.TileGrid({extent:s,minZoom:a,resolutions:this.mapResolutions}),u=new ol.layer.Tile({source:new ol.source.XYZ({projection:"PIXELS",tileGrid:p,url:e.mapUrl+"{z}/{x}/{y}.png"})});this.layers.push(u),this._map=new ol.Map({logo:!1,target:e.domId,view:new ol.View({projection:ol.proj.get("PIXELS"),extent:t,maxResolution:p.getResolution(o),zoom:e.zoom,maxZoom:r,minZoom:o}),overlays:[this._overlay],layers:this.layers,interactions:ol.interaction.defaults({dragPan:this.dragPan,pinchRotate:!1}),controls:ol.control.defaults({attribution:this.attribution,zoom:this.controlZoom}),moveTolerance:e.moveTolerance}),this._map.getView().fit(t,this._map.getSize()),this.setZoom(e.zoom);var c=e.rangeCoefficient;this.mapConfig.viewRange={minX:-(c-1)*e.sizeW,maxX:c*e.sizeW,minY:-c*e.sizeH,maxY:(c-1)*e.sizeH}},A.prototype.initBitmap=function(e){var t=[];t.push(e.sizeW/2*-1,e.sizeH/2*-1,e.sizeW/2,e.sizeH/2);var o=new ol.proj.Projection({code:"EPSG:3857",extent:t}),r=new ol.layer.Image({source:new ol.source.ImageStatic({url:e.mapUrl,projection:o,imageExtent:t,imageSize:[e.sizeW,e.sizeH]})});this.layers.push(r),e.maxZoom||(e.maxZoom=7),e.minZoom||(e.minZoom=0),e.zoom||(e.zoom=3),this._map=new ol.Map({logo:!1,target:e.domId,overlays:[this._overlay],layers:this.layers,view:new ol.View({projection:o,center:ol.extent.getCenter(t),zoom:e.zoom,maxZoom:e.maxZoom,minZoom:e.minZoom,extent:[e.sizeW/2*-1,e.sizeH/2*-1,e.sizeW/2,e.sizeH/2]}),interactions:ol.interaction.defaults({dragPan:this.dragPan}),controls:ol.control.defaults({attribution:this.attribution,zoom:this.controlZoom})})},A.prototype.initBaiduMap=function(e){if(1===e.sat){var t=new ol.layer.Tile({source:new ol.source.XYZ({projection:"baidu",maxZoom:18,tileUrlFunction:function(t){var o=t[1],r=t[2],a=t[0],n=e.mapUrl;return n=n.replace("{x}",o).replace("{y}",r).replace("{z}",a)},tileGrid:new ol.tilegrid.TileGrid({resolutions:x,origin:[0,0],extent:ol.extent.applyTransform(T,b.ll2bmerc),tileSize:[256,256]})})}),o=new ol.layer.Tile({source:new ol.source.XYZ({projection:"baidu",maxZoom:18,tileUrlFunction:function(t){var o=t[1],r=t[2],a=t[0],n=e.satUrl;return n=n.replace("{x}",o).replace("{y}",r).replace("{z}",a)},tileGrid:new ol.tilegrid.TileGrid({resolutions:x,origin:[0,0],extent:ol.extent.applyTransform(T,b.ll2bmerc),tileSize:[256,256]})})});this.layers.push(t),this.layers.push(o)}else{var r=new ol.layer.Tile({source:new ol.source.XYZ({projection:"baidu",maxZoom:18,tileUrlFunction:function(t){var o=t[1],r=t[2],a=t[0],n=e.mapUrl;return n=n.replace("{x}",o).replace("{y}",r).replace("{z}",a)},tileGrid:new ol.tilegrid.TileGrid({resolutions:x,origin:[0,0],extent:ol.extent.applyTransform(T,b.ll2bmerc),tileSize:[256,256]})})});this.layers.push(r)}e.maxZoom||(e.maxZoom=19),e.minZoom||(e.minZoom=0),e.zoom||(e.zoom=8),e.center&&2===e.center.length||(e.center=[112.334403,39.8]),this._map=new ol.Map({layers:this.layers,target:e.domId,logo:!1,view:new ol.View({center:this.translate_4326_to_3857(this.translate_4326_to_bd09(e.center)),projection:"EPSG:3857",zoom:e.zoom,maxZoom:e.maxZoom,minZoom:e.minZoom}),interactions:ol.interaction.defaults({dragPan:this.dragPan}),controls:ol.control.defaults({attribution:this.attribution,zoom:this.controlZoom})}),this.mapConfig=e},A.prototype.initGaodeMap=function(e){if(1===e.sat){var t=new ol.layer.Tile({source:new ol.source.XYZ({maxZoom:18,url:e.satUrl})});this.layers.push(t)}else{var o=new ol.layer.Tile({source:new ol.source.XYZ({maxZoom:18,url:e.mapUrl})});this.layers.push(o)}e.maxZoom||(e.maxZoom=19),e.minZoom||(e.minZoom=0),e.zoom||(e.zoom=8),e.center&&2===e.center.length||(e.center=[112.334403,39.8]),this._map=new ol.Map({layers:this.layers,target:e.domId,logo:!1,view:new ol.View({center:this.translate_4326_to_3857(this.translate_4326_to_gcj02(e.center)),projection:"EPSG:3857",zoom:e.zoom,maxZoom:e.maxZoom,minZoom:e.minZoom})}),this.mapConfig=e},A.prototype.initGisLayer=function(){var e=new ol.source.Vector({features:[]}),t=new ol.layer.HDVector("gisLayer",{source:e,style:null,zIndex:10});return this._map.addLayer(t),this.outterLayers.gisLayer=t,t},A.prototype.initLineLayer=function(){var e=new ol.source.Vector({features:[]}),t=new ol.layer.HDVector("lineLayer",{source:e,style:new ol.style.Style({stroke:new ol.style.Stroke({color:"#ff0033",width:2}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#ff0033"})})}),zIndex:10});return this._map.addLayer(t),this.outterLayers.lineLayer=t,t},A.prototype.createPopup=function(e){document.body.appendChild(this.createNode("wrap","div","id",e.popup,"hdmap-ol-popup")),this.popup_container=document.getElementById(e.popup),this.toggleClassName(this.popup_container,"hdmap-list-popup","hdmap-ol-popup"),this.popup_closestatus||(this.popup_container.appendChild(this.createNode("popcloser","a","id",e.popupcloser)),this.popup_closer=document.getElementById(e.popupcloser),this.toggleClassName(this.popup_closer,"hdmap-list-popup-closer","hdmap-ol-popup-closer")),this.popup_container.appendChild(this.createNode("popcontent","div","id",e.popupcontent)),this.popup_content=document.getElementById(e.popupcontent),this.popup_container.appendChild(this.createNode("popcontent","div","id",e.popupcontent))},A.prototype.popupInit=function(e){if(!document.getElementById(this._outPopupWarp)){var t=document.createElement("div");t.id=this._outPopupWarp,t.style.zIndex="-1",document.body.appendChild(t)}e&&(this.popup_closestatus=e.popupstatus,this.popup_container=document.getElementById(e.popup),this.popup_content=document.getElementById(e.popupcontent),null===this.popup_container&&this.createPopup(e),this._overlay=new ol.Overlay({element:this.popup_container,autoPan:!0,autoPanAnimation:{duration:250}}))},A.prototype.saveOutterPopup=function(e){var t=document.getElementById(this._outPopupWarp);if(t.children.length!==e.length&&e instanceof Array)for(var r=0,a=e.length;r<a;r++){var n=document.getElementById(e[r]);if(n){var i=n.parentNode;t.appendChild(n),i.parentNode.removeChild(i)}else console.warn(o+"popId is undefined")}},A.prototype.addMarker=function(e,t,r){if(!e.position||2!==e.position.length)return console.warn(o+"addMarker Error : marker position can not be empty"),null;if(!this.isInTileMapViewArea(e.position))return console.warn(o+"addMarker Error : marker position is not in tile map viewArea"),null;if(!e.id)return console.warn(o+"addMarker Error : id is required"),null;if(e.zoomLevel&&(e.zoomLevel>this.mapConfig.maxZoom||e.zoomLevel<this.mapConfig.minZoom))return console.warn(o+"addMarker Error : zoomLevel is not between maxZoom & minZoom"),null;var a=void 0!==r?r:B.getLayerKeyByType(e.markerType,e.zoomLevel),n=this.getLayerByKey(a);void 0!==n&&null!==n||(n=this.addLayerByLayerKey(a));var i=this.getMarkerBylayerKey(e.id,a);if(i)return this.updateMarker(e,t,r),i;var s=Z(e,a);return s.setStyle(hdmap.commonConfig.getFeatureStyle(e,t)),n.getSource().addFeature(s),s},A.prototype.addCountMarker=function(e,t){if("countWarning"===e.markerType||"countCamera"===e.markerType||"countBroadcast"===e.markerType){var r=Object.assign({},e);r.id=r.id+"base",this.addBgLayer(r);var a=B.getLayerKeyByType(e.markerType),n=this.getLayerByKey(a),i="";void 0!==n&&null!==n||(n=this.addLayerByLayerKey(a));var s=Z(e,a);"countCamera"===e.markerType?i=hdmap.commonConfig.getCountCameraFeatureStyle(e,t):"countWarning"===e.markerType?i=hdmap.commonConfig.getCountWarningFeatureStyle(e,t):"countBroadcast"===e.markerType&&(i=hdmap.commonConfig.getCountBroadcastFeatureStyle(e,t)),s.setStyle(i),n.getSource().addFeature(s)}else console.warn(o+"markerType is error")},A.prototype.addBgLayer=function(e){var t=e.markerType+"Base",o=B.getLayerKeyByType(t),r=this.getLayerByKey(o);void 0!==r&&null!==r||(r=this.addLayerByLayerKey(o));var a=Z(e,o);"countWarning"===e.markerType?a.setStyle(hdmap.commonConfig.getCountWarningStyle(e)):"countCamera"===e.markerType?a.setStyle(hdmap.commonConfig.getCountDefaultStyle(e)):"countBroadcast"===e.markerType&&a.setStyle(hdmap.commonConfig.getCountDefaultStyle(e)),r.getSource().addFeature(a)},A.prototype.hideCountMarkers=function(e){var t=e+"Base",o=B.getLayerKeyByType(e),r=B.getLayerKeyByType(t);this.setLayerVisible(o,!1),this.setLayerVisible(r,!1)},A.prototype.showCountMarkers=function(e){var t=e+"Base",o=B.getLayerKeyByType(e),r=B.getLayerKeyByType(t);this.setLayerVisible(o,!0),this.setLayerVisible(r,!0)},A.prototype.removeCountMarkers=function(e){var t=e+"Base",o=B.getLayerKeyByType(e),r=B.getLayerKeyByType(t);this.removeLayerByLayerKey(o),this.removeLayerByLayerKey(r)},A.prototype.addMarkerByGPS=function(e,t){1===this.mapConfig.scaleType||"1"===this.mapConfig.scaleType?(e.GPSInfo=e.position,e.position=this.transfromWGSToBitMap(e.position),this.addMarker(e,t)):console.warn(o+"ScaleType is error")},A.prototype.addMarkersByGPS=function(e,t){if(e instanceof Array)for(var r=0;r<e.length;r++){var a=e[r];this.addMarkerByGPS(a,t)}else console.warn(o+"addMarkersByGPS require an Array instance argument")},A.prototype.addMarkers=function(e,t,r){if(e instanceof Array)for(var a=0;a<e.length;a++){var n=e[a];this.addMarker(n,t,r)}else console.warn(o+"addMarkers require an Array instance argument")},A.prototype.hideMarkers=function(e){var t=B.getLayerKeyByType(e);this.setLayerVisible(t,!1,!1)},A.prototype.showMarkers=function(e){var t=B.getLayerKeyByType(e);this.setLayerVisible(t,!0,!0)},A.prototype.removeMarkerBylayerKey=function(e,t){var r=this.getLayerByKey(t);if(!r)return console.warn(o+"please give a legal layerkey"),null;var a=r.getSource().getFeatureById(e);a&&r.getSource().removeFeature(a)},A.prototype.removeMarker=function(e){if(e.markerType&&e.id){var t=B.getLayerKeyByType(e.markerType);if(t&&"commonLayer"!==t){var r=this.getLayerByKey(t);r||console.warn(o+"can not find this layer:"+t);var a=r.getSource().getFeatureById(e.id);a&&r.getSource().removeFeature(a)}}else console.warn(o+"markerInfo is error")},A.prototype.updateMarker=function(e,t,r){if(!e.id)return console.warn(o+"markerId can not be empty"),null;var a=void 0!==r?r:B.getLayerKeyByType(e.markerType,e.zoomLevel),n=this.getMarkerBylayerKey(e.id,a);if(n){var i=n.getExtProperties();this.copyAttr(i,e),e.position&&n.getGeometry().setCoordinates(e.position),e.markerName&&n.set("markerName",e.markerName),n.setStyle(hdmap.commonConfig.getFeatureStyle(e,t))}else console.warn(o+"This point does not exist")},A.prototype.copyAttr=function(e,t){for(var o in t)e[o]=t[o]},A.prototype.getMarkerBylayerKey=function(e,t){var r=this.getLayerByKey(t);if(!r)return console.warn(o+"please give a layerkey"),null;return r.getSource().getFeatureById(e)},A.prototype.getMarkerById=function(e){for(var t=this.getMap().getLayers().array_,o=1,r=t.length;o<r;o++){var a=t[o].getSource().getFeatureById(e);if(a)return a}},A.prototype.addArea=function(e,t){var o=this.outterLayers.gisLayer;o||(o=this.initGisLayer()),e.id||(e.id=(new Date).valueOf());var r=this.getMarkerBylayerKey(e.id,"gisLayer");if(r)return r.getGeometry().setCoordinates(e.borderPoints),r.setExtProperties(e),e.rotate&&r.setRotate(e.rotate),r;var a=new ol.AreaFeature({geometry:new ol.geom.Polygon(e.borderPoints),geometryName:"Polygon",style:null},e,"gisLayer");return a.setId(e.id),t&&a.setStyle(hdmap.commonConfig.setAreaStyle(t)),o.getSource().addFeature(a),a},A.prototype.addAreas=function(e,t){if(e instanceof Array)for(var r=0;r<e.length;r++){var a=e[r];this.addArea(a,t)}else console.warn(o+"addAreas require an Array instance argument")},A.prototype.updateArea=function(e,t){var r=this.getMarkerBylayerKey(e.id,"gisLayer");r?r.setStyle(t):console.warn(o+"Warning of hdmap: not find the area")},A.prototype.removeArea=function(e){this.removeMarkerBylayerKey(e.id,"gisLayer")},A.prototype.hideArea=function(e){var t=this.getMarkerBylayerKey(e.id,"gisLayer");t.extProperties.visible=!1,t.setStyle(null)},A.prototype.showArea=function(e){var t=this.getMarkerBylayerKey(e.id,"gisLayer");t.setStyle(hdmap.commonConfig.getMouseOverAreaStyle()),t.extProperties.visible=!0},A.prototype.addLine=function(e,t){if(e&&e.borderPoints){var r=this.outterLayers.lineLayer;r||(r=this.initLineLayer());var a=null;t&&(a=new ol.style.Style({stroke:new ol.style.Stroke(t)}));var n=this.getMarkerBylayerKey(e.id,"lineLayer");if(n)return n.getGeometry().setCoordinates(e.borderPoints),n.setExtProperties(e),a&&n.setStyle(a),n;var i=new ol.LineFeature({geometry:new ol.geom.LineString(e.borderPoints),geometryName:"LineString",style:a},e,"lineLayer");return i.setId(e.id),a&&i.setStyle(a),r.getSource().addFeature(i),i}console.warn(o+"addLine require an lineInfo Object")},A.prototype.addLines=function(e){if(e instanceof Array){for(var t=[],r=null,a=0;a<e.length;a++){var n=e[a],i=e[a].lineStyle;r=this.addLine(n,i),t.push(r)}return t}console.warn(o+"addLines require an Array instance argument")},A.prototype.updateLine=function(e,t){var r=this.getMarkerBylayerKey(e.id,"lineLayer");r?r.setStyle(t):console.warn(o+"Warning of hdmap: not find the line")},A.prototype.removeLine=function(e){this.removeMarkerBylayerKey(e.id,"lineLayer")},A.prototype.hideLine=function(e){this.getMarkerBylayerKey(e.id,"lineLayer").setStyle(null)},A.prototype.getOutterLayers=function(){return this.outterLayers},A.prototype.addLayerByLayerKey=function(e){if(e){var t=new ol.source.Vector({}),r=new ol.layer.HDVector(e,{source:t,zIndex:11});this._map.addLayer(r),this.outterLayers[e]=r;var a=e.split("_");if(a[1]){var n=parseInt(a[1]),i=!0;this.getZoom()<n&&(i=!1),r.setVisible(i)}return r}return console.warn(o+"addLayer Error : layerKey can not be empty"),null},A.prototype.removeLayerByLayerKey=function(e){var t=this.getLayerByKey(e);t&&(t.getSource().clear(),this._map.removeLayer(t),delete this.outterLayers[e])},A.prototype.getLayerByKey=function(e){var t=this.outterLayers[e];if(t)return t},A.prototype.getTimerByKey=function(e){var t=this.areaTimer[e];if(t)return t},A.prototype.popupSetPlace=function(e){if(this._overlay.setPosition(e),this.popup_closer){var t=this;this.popup_closer.onclick=function(){t._overlay.setPosition(void 0),t.popup_closer.blur()}}},A.prototype.addPopup=function(e){if("string"==typeof e)if(document.getElementById(e)){var t=this.createNode("wrapperDom","div","id",e+"-wrapper","hdmap-popup-wrapper");document.body.appendChild(t);var r=new ol.Overlay({});r.setElement(t),this._overlays[e]=r,this._overlays[e].show=!1,this.getMap().addOverlay(r);var a=document.getElementById(e).offsetHeight;t.style.height=a+"px";var n=document.getElementById(e).offsetWidth;t.style.width=n+"px",t.appendChild(document.getElementById(e))}else console.warn(o+"The element node does not exist");else if("object"===(void 0===e?"undefined":K(e))&&!0===e.visible)if(document.getElementById(e.domId)){var i;i=!0===e.arrow?this.createNode("wrapperDomObject","div","id",e.domId+"-wrapper","hdmap-popup-wrapper-arrow"):this.createNode("wrapperDomObject","div","id",e.domId+"-wrapper","hdmap-popup-wrapper"),document.body.appendChild(i);var s=new ol.Overlay({});s.setElement(i),this._overlays[e.domId]=s,this._overlays[e.domId].visible=e.visible,this._overlays[e.domId].show=!1,e.type&&(this._overlays[e.domId].type=e.type),this.getMap().addOverlay(s);var l=document.getElementById(e.domId).offsetHeight;i.style.height=l+"px";var p=document.getElementById(e.domId).offsetWidth;i.style.width=p+"px",i.appendChild(document.getElementById(e.domId))}else console.warn(o+"The element node does not exist")},A.prototype.showPopup=function(e,t,r){if(e){var a=parseInt(document.getElementById(e).parentNode.style.height),n=parseInt(document.getElementById(e).parentNode.style.width);if(r&&"object"===(void 0===r?"undefined":K(r))){var i=r.top?parseInt(r.top):-30,s=r.left?parseInt(r.left):0;document.getElementById(e).parentNode.style.top=-a+i+"px",document.getElementById(e).parentNode.style.left=-n/2+s+"px"}else document.getElementById(e).parentNode.style.top=-a-12+"px";this.closeCommonPopup(),this._overlays[e].show=!0,this._overlays[e].setPosition(t),D.setPopupZIndex(e)}else console.warn(o+"The element node does not exist")},A.prototype.popupDefault=function(e,o){if(this.closeCommonPopup(),this.toggleClassName(this.popup_container,"hdmap-list-popup","hdmap-ol-popup"),this.toggleClassName(this.popup_container,"hdmap-list-popup-multi","hdmap-ol-popup-default"),this.toggleClassName(this.popup_closer,"hdmap-list-popup-closer","hdmap-ol-popup-closer"),this.popup_content.innerHTML=o,this.popupSetPlace(e),!this.popup_container.parentNode.querySelector(".hdmap-list-popup-arrow")){var r=document.createElement("div");r.setAttribute("class","hdmap-list-popup-arrow"),this.popup_container.parentNode.appendChild(r);var a=new t(this.popup_container);console.log(a)}},A.prototype.popupMultipoint=function(e,o){var r=this;if(this.popup_content.innerHTML="",this.closeCommonPopup(),this.toggleClassName(this.popup_container,"hdmap-ol-popup","hdmap-list-popup"),this.toggleClassName(this.popup_container,"hdmap-ol-popup-default","hdmap-list-popup-multi"),!this.popup_container.parentNode.querySelector(".hdmap-list-popup-arrow")){var a=document.createElement("div");a.setAttribute("class","hdmap-list-popup-arrow"),this.popup_container.parentNode.appendChild(a);var n=new t(this.popup_container);console.log(n)}this.popup_closer.classList.remove("hdmap-ol-popup-closer"),this.popup_contentWrap.length=0;for(var i=0,s=o.length;i<s;i++){var l=document.createElement("div");l.classList.add("hdmap-list-popupcontent");var p=document.createElement("img");p.src=o[i].imgUrl?o[i].imgUrl:o[i].url,p.classList.add("hdmap-list-popupimg");var u=document.createElement("p");u.classList.add("hdmap-list-popupparm"),u.innerHTML=o[i].markerName,l.appendChild(p),l.appendChild(u),this.popup_contentWrap.push(l),this.popup_content.appendChild(l)}for(var c=this,h=function(t,a){r.popup_contentWrap[t].onclick=function(r){c.closeCommonPopup();c.eventCallback.singleclick.default.call(this,{feature:o[t],eventType:"singleclick",coordinate:e,mapEvent:r})}},d=0,y=this.popup_contentWrap.length;d<y;d++)h(d);this.popupSetPlace(e)},A.prototype.popupNoFeature=function(e){this.toggleClassName(this.popup_container,"hdmap-list-popup","hdmap-ol-popup"),this.toggleClassName(this.popup_closer,"hdmap-list-popup-closer","hdmap-ol-popup-closer"),this.popup_content.innerHTML="当前位置："+e,this.popupSetPlace(e)},A.prototype.closePopup=function(){for(var e in this._overlays)this._overlays[e].show&&(this._overlays[e].show=!1),this._overlays[e].setPosition(void 0);this._overlay.setPosition(void 0),this.popup_closer&&this.popup_closer.blur(),D.curPopNum=this.popupShowNum(),D.reset()},A.prototype.closeCommonPopup=function(){for(var e in this._overlays)void 0===this._overlays[e].visible&&(this._overlays[e].show&&(this._overlays[e].show=!1),this._overlays[e].setPosition(void 0));this._overlay.setPosition(void 0),this.popup_closer&&this.popup_closer.blur()},A.prototype.regDefaulEventCallback=function(){for(var e in E){var t=this._map,o=null;o="zoomChange"===e?this._map.getView().on("change:resolution",E[e],t):this._map.on(e,E[e]),this.eventKey[e]=o}},A.prototype.warnAnimation=function(e){var t=this;this.getMarkerBylayerKey(e.id,"gisLayer").extProperties.visible=!0;var o=this.getTimerByKey(e.id);void 0===o||null===o?o=e.id:clearInterval(o);var r=0,a=setInterval(function(){r++;var o=(r%=20)/50+.1;t.updateArea(e,hdmap.commonConfig.getWarningAreaStyle(o))},50);this.areaTimer[e.id]=a},A.prototype.warnCancel=function(e){var t=this.getMarkerBylayerKey(e.id,"gisLayer"),o=this.getTimerByKey(e.id);o&&(clearInterval(o),t.extProperties.visible=!1,this.updateArea(e,null))},A.prototype.regEventListener=function(e,t,o){"string"==typeof e&&"function"==typeof t&&void 0!==this.eventCallback[e]&&(o?this.eventCallback[e][o]=t:this.eventCallback[e].default=t)},A.prototype.unRegEventListener=function(e,t){"string"==typeof e&&void 0!==this.eventCallback[e]&&(t?this.eventCallback[e][t]=null:this.eventCallback[e].default=null)},A.prototype.addEventListener=function(e,t){var o=this._map.on(e,t);return this.eventKey[e]=o,o},A.prototype.removeEventListener=function(e){var t=this.eventKey[e];t&&(this._map.unByKey(t),delete this.eventKey[e])},A.prototype.getMap=function(){return this._map},A.prototype.getMapUid=function(){return this._map.ol_uid},A.prototype.drawFeature=function(e,t,o,r,a){if(e&&o&&a&&o.length>0){var n=this.getLayerByKey(a);null==n&&(n=this.addLayer(a));var i=null;if("point"===t&&o.length>0)n.setStyle(new ol.style.Style({image:new ol.style.Circle(r)})),i=new ol.Feature({id:e,geometry:new ol.geom.Point([o[0].mapX,o[0].mapY])});else if("line"===t&&o.length>0){n.setStyle(new ol.style.Style({stroke:new ol.style.Stroke(r)}));for(var s=[],l=0;l<o.length;l++){var p=[];p.push(o[l].mapX),p.push(o[l].mapY),s.push(p)}i=new ol.Feature({id:e,geometry:new ol.geom.LineString(s)})}return n.getSource().addFeature(i),i}},A.prototype.initDrawLineTool=function(e,t,o){if(!this.drawTool.lineDraw){var r=new ol.source.Vector,a=new ol.layer.HDVector("drawLineLayer",{source:r,style:function(r,a){var n=r.getGeometry(),i=[new ol.style.Style({stroke:new ol.style.Stroke(e)})];return"function"==typeof o&&n.forEachSegment(function(e,r){for(var a=o.call(this,e,r),n=0;n<a.length;n++)i.push(new ol.style.Style({geometry:new ol.geom.Point(a[n]),image:t}))},r),i}});this.outterLayers.drawLineLayer=a,this._map.addLayer(a),this.drawTool.lineModify=new ol.interaction.Modify({source:r}),this.drawTool.lineDraw=new ol.interaction.Draw({source:r,type:"LineString"}),this.drawTool.lineSnap=new ol.interaction.Snap({source:r})}},A.prototype.openDrawLineTool=function(e,t,o,r,a,n){var i=this;this.setMapEditState("drawLineState"),this.initDrawLineTool(e,t,o),this._map.addInteraction(this.drawTool.lineModify),this._map.addInteraction(this.drawTool.lineDraw),this._map.addInteraction(this.drawTool.lineSnap),this.eventKey.linedrawstart=this.drawTool.lineDraw.on("drawstart",function(e){var t=i;if(!n&&void 0!==n){var o=e.target.map_,r=e.target.downPx_,a=[];o.getFeaturesAtPixel(r).map(function(e,t){"LineString"===e.getGeometry().getType()&&a.push(e.ol_uid)});i.getFrontDrawLine().map(function(e,o){-1===a.indexOf(e.ol_uid)&&t.removeFrontDrawLine(e)})}}),r&&(this.eventKey.linedrawend=this.drawTool.lineDraw.on("drawend",function(e){r.call(i,e)})),a&&(this.eventKey.linemodifyend=this.drawTool.lineModify.on("modifyend",function(e){a.call(this,e)}))},A.prototype.showDrawLine=function(e){if(!e)return console.warn(o+"showDrawLine Error : option is  must need"),null;var t=this.outterLayers.drawLineLayer;if(t){var r=t.getSource(),a=r.getFeatures();if(0===a.length)return console.warn(o+"showDrawLine Error : there is no feature for save"),null;var n=[],i=[];e instanceof Array&&e.length>0?i=i.concat(e):e instanceof Object&&i.push(e);for(var s=0,l=i.length,p=a.length-1;p>=0;p--)if(s<l){var u=a[p].getGeometry().getCoordinates(),c=(new Date).valueOf()+1e3*Math.random(),h={id:c,name:"lineFeature_"+c,lineType:"001"};if(i[s]&&i[s].id&&(h=Object.assign({},i[s])),a[p]instanceof ol.LineFeature){var d=a[p].getExtProperties();d&&(h=Object.assign({},d))}h.borderPoints=u;var y=this.addLine(h);n.push(y),s++}return r.clear(),!e||e instanceof Array?n:n[0]}return null},A.prototype.clearDrawLine=function(){var e=this.outterLayers.drawLineLayer;if(e){e.getSource().clear()}},A.prototype.getFrontDrawLine=function(){var e=this.outterLayers.drawLineLayer;if(e){return e.getSource().getFeatures()}return[]},A.prototype.removeFrontDrawLine=function(e){var t=this.outterLayers.drawLineLayer;if(t){t.getSource().removeFeature(e)}},A.prototype.editDrawLine=function(e,t,r,a,n,i){if(e){if(e.position?e.position:e.borderPoints){var s=null;if(e instanceof ol.Feature)s=e;else if(e instanceof Object){var l=null;t&&(l=new ol.style.Style({stroke:new ol.style.Stroke(t)})),(s=new ol.LineFeature({geometry:new ol.geom.LineString(e.borderPoints),geometryName:"LineString",style:l},e,"lineLayer")).setId(e.id),l&&s.setStyle(l)}var p=this.outterLayers.drawLineLayer;p&&s?(p.getSource().addFeature(s),this._map.addInteraction(this.drawTool.lineModify),this._map.addInteraction(this.drawTool.lineSnap),this.setMapEditState("drawLineState")):(this.openDrawLineTool(t,r,a,n,i),(p=this.outterLayers.drawLineLayer).getSource().addFeature(s),this._map.removeInteraction(this.drawTool.lineDraw))}else console.warn(o+"editDrawLine Error : line option.borderPoints or option.position can not be null")}else console.warn(o+"editDrawLine Error : line option can not be null")},A.prototype.createDrawIntera=function(e,t){var o;"Box"===e?(e="Circle",o=ol.interaction.Draw.createBox()):"Square"===e&&(e="Circle",o=ol.interaction.Draw.createRegularPolygon(4)),this.drawTool.shapeDraw=new ol.interaction.Draw({source:t,type:e,geometryFunction:o,maxPoints:void 0})},A.prototype.initDrawShapeTool=function(e){var t=null;if(this.drawTool.shapeDraw){if(this.drawTool.shapeDraw.type!==e){this._map.removeInteraction(this.drawTool.shapeDraw);t=this.outterLayers.drawShapeLayer.getSource(),this.createDrawIntera(e,t)}}else{t=new ol.source.Vector({wrapX:!1});var o=new ol.layer.HDVector("drawShapeLayer",{source:t,style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"#33c7ff",width:2}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#33c7ff"})})})});this.drawTool.shapeSelect=new ol.interaction.Select({layers:[o]}),this.drawTool.shapeModify=new ol.interaction.Modify({source:t}),this.createDrawIntera(e,t),this.drawTool.shapeSnap=new ol.interaction.Snap({source:t}),this.outterLayers.drawShapeLayer=o,this._map.addLayer(o)}},A.prototype.openDrawShapeTool=function(e,t,o,r){var a=this;e||(e="Polygon"),this.setMapEditState("drawShapeState"),this.initDrawShapeTool(e),this.eventKey.shapedrawstart=this.drawTool.shapeDraw.on("drawstart",function(e){var t=a;if(!r&&void 0!==r){var o=e.target.map_,n=e.target.downPx_,i=[];o.getFeaturesAtPixel(n).map(function(e,t){"Polygon"===e.getGeometry().getType()&&i.push(e.ol_uid)});a.getFrontDrawShape().map(function(e,o){-1===i.indexOf(e.ol_uid)&&t.removeFrontDrawShape(e)})}}),t&&(this.eventKey.shapedrawend=this.drawTool.shapeDraw.on("drawend",function(e){t.call(this,e)})),o&&(this.eventKey.shapemodifyend=this.drawTool.shapeModify.on("modifyend",function(e){o.call(this,e)})),this._map.addInteraction(this.drawTool.shapeModify),this._map.addInteraction(this.drawTool.shapeDraw),this._map.addInteraction(this.drawTool.shapeSnap)},A.prototype.showDrawShape=function(e){if(!e)return console.warn(o+"showDrawShape Error : option is  must need"),null;var t=this.outterLayers.drawShapeLayer,r=[];if(t){var a=t.getSource(),n=a.getFeatures();if(0===n.length)return console.warn(o+"showDrawShape Error : there is no feature for save"),null;var i=[];e instanceof Array&&e.length>0?i=i.concat(e):e instanceof Object&&i.push(e);for(var s=0,l=i.length,p=n.length-1;p>=0;p--)if(s<l){var u=n[p].getGeometry().getCoordinates(),c=(new Date).valueOf()+1e3*Math.random(),h={id:c,name:"areaFeature_"+c,areaType:"001"};if(i[s]&&i[s].id&&(h=Object.assign({},i[s])),n[p]instanceof ol.AreaFeature){var d=n[p].getExtProperties();d&&(d.rotate=n[p].getRotate(),d.areaTypesOf=n[p].getAreaTypesOf(),h=Object.assign({},d))}h.borderPoints=u;var y=this.addArea(h);r.push(y),s++}return a.clear(),this.closeDrawShapeTool(),!e||e instanceof Array?r:r[0]}},A.prototype.clearDrawShape=function(){var e=this.outterLayers.drawShapeLayer;if(e){e.getSource().clear()}},A.prototype.getFrontDrawShape=function(){var e=this.outterLayers.drawShapeLayer;if(e){return e.getSource().getFeatures()}return[]},A.prototype.removeFrontDrawShape=function(e){var t=this.outterLayers.drawShapeLayer;if(t){t.getSource().removeFeature(e)}},A.prototype.editDrawShape=function(e,t){if(e){var a=e.position?e.position:e.borderPoints;if(a){var n=null;e instanceof ol.Feature?n=e:e instanceof Object&&(n=new ol.AreaFeature({geometry:new ol.geom.Polygon(a),geometryName:"Polygon",style:null},e,"drawShapeLayer")).setId(e.id);var i=this.outterLayers.drawShapeLayer,s=this.getMapEditState();i&&n?"drawShapeState"!==s&&this.setMapEditState("drawShapeState"):(this.openDrawShapeTool("Polygon"),i=this.outterLayers.drawShapeLayer),i.getSource().addFeature(n),s&&"drawShapeState"===s||(e.areaTypesOf&&"parking"===e.areaTypesOf?(this._map.removeInteraction(this.drawTool.shapeModify),this._map.addInteraction(this.drawTool.shapeSelect),this.drawTool.shapeSelect.setActive(!1)):(this._map.addInteraction(this.drawTool.shapeModify),this._map.addInteraction(this.drawTool.shapeSnap)),this._map.removeInteraction(this.drawTool.shapeDraw),this.drawTool.transform||(this.drawTool.transform=new ol.interaction.Transform({translateFeature:!1,scale:!0,rotate:!0,keepAspectRatio:ol.events.condition.always,translate:!0,stretch:!1,layers:[i]}),this.drawTool.transform.on(["rotateend","translateend","scaleend"],function(e){var t=e.feature.get("angle");"rotateend"===e.type&&(t=-((180*t/Math.PI-180)%360+180),e.feature.setRotate instanceof Function&&e.feature.setRotate(e.feature.rotate+t)),console.log(r+"当前的旋转角度："+e.feature.rotate)}),this.drawTool.transform.on("select",function(e){t&&t.call(this,e)})),this._map.addInteraction(this.drawTool.transform))}else console.warn(o+"editDrawShape Error : shape option.borderPoints or option.position can not be null")}else console.warn(o+"editDrawShape Error : shape option can not be null")},A.prototype.setMapEditState=function(e){switch(e){case"drawLineState":this.drawTool.drawLineState=!0,this.closeDrawShapeTool(),this.closeDragTool();break;case"drawShapeState":this.drawTool.drawShapeState=!0,this.closeDrawLineTool(),this.closeDragTool();break;case"dragState":this.dragFeatureTool.dragState=!0,this.closeDrawLineTool(),this.closeDrawShapeTool();break;default:this.closeDrawLineTool(),this.closeDrawShapeTool(),this.closeDragTool()}this.drawTool.drawState=e},A.prototype.getMapEditState=function(){return this.drawTool.drawState?this.drawTool.drawState:""},A.prototype.closeDrawShapeTool=function(){if(this.drawTool.drawShapeState){var e=this.eventKey.shapedrawstart,t=this.eventKey.shapedrawend,o=this.eventKey.shapemodifyend;ol.Observable.unByKey(e),delete this.eventKey.shapedrawstart,ol.Observable.unByKey(t),delete this.eventKey.shapedrawend,ol.Observable.unByKey(o),delete this.eventKey.shapemodifyend,this._map.removeInteraction(this.drawTool.shapeSelect),this._map.removeInteraction(this.drawTool.shapeModify),this._map.removeInteraction(this.drawTool.shapeDraw),this._map.removeInteraction(this.drawTool.shapeSnap),this._map.removeInteraction(this.drawTool.transform),this.drawTool.drawShapeState=!1,this.drawTool.drawState=""}},A.prototype.closeDrawLineTool=function(){if(this.drawTool.drawLineState){var e=this.eventKey.linedrawstart,t=this.eventKey.linedrawend,o=this.eventKey.linemodifyend;ol.Observable.unByKey(e),delete this.eventKey.linedrawstart,ol.Observable.unByKey(t),delete this.eventKey.linedrawend,ol.Observable.unByKey(o),delete this.eventKey.linemodifyend,this._map.removeInteraction(this.drawTool.lineModify),this._map.removeInteraction(this.drawTool.lineDraw),this._map.removeInteraction(this.drawTool.lineSnap),this.drawTool.drawLineState=!1,this.drawTool.drawState=""}},A.prototype.getDrawLineState=function(){return this.drawTool.drawLineState},A.prototype.getDrawShapeState=function(){return this.drawTool.drawShapeState},A.prototype.setCenter=function(e,t){e&&(t?(this.setZoom(t),this._map.getView().setCenter(e)):this._map.getView().setCenter(e))},A.prototype.getCenter=function(){return this._map.getView().getCenter()},A.prototype.setZoom=function(e){"tile"===this.mapConfig.gisEngine?(e-=this.mapConfig.minZoom)&&e>this.mapConfig.maxZoom?this._map.getView().setZoom(this.mapConfig.maxZoom-this.mapConfig.minZoom):e&&e<0?this._map.getView().setZoom(0):this._map.getView().setZoom(e):e&&e>this.mapConfig.maxZoom?this._map.getView().setZoom(this.mapConfig.maxZoom):e&&e<this.mapConfig.minZoom?this._map.getView().setZoom(this.mapConfig.minZoom):this._map.getView().setZoom(e)},A.prototype.getZoom=function(){var e=this._map.getView().getZoom();return"tile"===this.mapConfig.gisEngine?e+this.mapConfig.minZoom:e},A.prototype.getLonLat=function(e,t){var o=this._map.getEventPixel(e),r=this._map.getCoordinateFromPixel(o);return t&&(r=ol.proj.transform(r,"EPSG:3857","EPSG:4326")),r},A.prototype.setLayerVisible=function(e,t,o){for(var r=this.mapConfig.maxZoom,a=this.getZoom(),n="",i=!1,s=null,l=Math.floor(r);l>0;l--)n=e+"_"+l,(s=this.getLayerByKey(n))&&(a>=l&&s.setVisible(t),void 0!==o&&s.setVisibleFlag(o),i=!0);(s=this.getLayerByKey(e))&&(s.setVisible(t),void 0!==o&&s.setVisibleFlag(o),i=!0),i&&this._map.updateSize()},A.prototype.initDragTool=function(){var e=[];for(var t in this.outterLayers)e.push(this.outterLayers[t]);this.dragFeatureTool.select=new ol.interaction.Select({filter:function(e,t){return!0},layers:e});this.dragFeatureTool.translate=new ol.interaction.Translate({features:this.dragFeatureTool.select.getFeatures()})},A.prototype.openDragTool=function(e,t,o,r,a,n){this.setMapEditState("dragState"),this.dragFeatureTool.translate&&this.dragFeatureTool.select||this.initDragTool(),e&&(this.eventKey.translatestart=this.dragFeatureTool.translate.on("translatestart",e)),t&&(this.eventKey.translateend=this.dragFeatureTool.translate.on("translateend",t)),a&&(this.eventKey.translating=this.dragFeatureTool.translate.on("translating",a)),o&&(this.eventKey.select=this.dragFeatureTool.select.on("select",o)),this.dragFeatureTool.select.set("multi",r),this._map.addInteraction(this.dragFeatureTool.select),n||this._map.addInteraction(this.dragFeatureTool.translate)},A.prototype.closeDragTool=function(){if(this.dragFeatureTool.dragState){var e=this.eventKey.translatestart,t=this.eventKey.translateend,o=this.eventKey.translating,a=this.eventKey.select;ol.Observable.unByKey(e),delete this.eventKey.translatestart,ol.Observable.unByKey(t),delete this.eventKey.translateend,ol.Observable.unByKey(o),delete this.eventKey.translating,ol.Observable.unByKey(a),delete this.eventKey.select,console.log(r+"transstart = "),console.log(e),this._map.removeInteraction(this.dragFeatureTool.select),this._map.removeInteraction(this.dragFeatureTool.translate),this.dragFeatureTool.select=null,this.dragFeatureTool.translate=null,this.dragFeatureTool.dragState=!1,this.drawTool.drawState=""}},A.prototype.getDragState=function(){return this.dragFeatureTool.dragState},A.prototype.translate_4326_to_3857=function(e){if(!(e[0]>180||e[0]<-180||e[1]>90||e[1]<-90)){return ol.proj.transform(e,"EPSG:4326","EPSG:3857")}console.warn(o+"Error: Longitude range: -180 to 180, latitude range: -90 to 90")},A.prototype.translate_3857_to_4326=function(e){return ol.proj.transform(e,"EPSG:3857","EPSG:4326")},A.prototype.translate_bd09_to_gcj02=function(e){if(!(e[0]>180||e[0]<-180||e[1]>90||e[1]<-90)){var t=e[0]-.0065,r=e[1]-.006,a=Math.sqrt(t*t+r*r)-2e-5*Math.sin(r*_),n=Math.atan2(r,t)-3e-6*Math.cos(t*_),i=[];return i.push(a*Math.cos(n)),i.push(a*Math.sin(n)),i}console.warn(o+"Error: Longitude range: -180 to 180, latitude range: -90 to 90")},A.prototype.translate_gcj02_to_bd09=function(e){if(!(e[0]>180||e[0]<-180||e[1]>90||e[1]<-90)){var t=e[0],r=e[1],a=Math.sqrt(t*t+r*r)+2e-5*Math.sin(r*_),n=Math.atan2(r,t)+3e-6*Math.cos(t*_),i=[];return i.push(a*Math.cos(n)+.0065),i.push(a*Math.sin(n)+.006),i}console.warn(o+"Error: Longitude range: -180 to 180, latitude range: -90 to 90")},A.prototype.translate_gcj02_to_4326=function(e){if(!(e[0]>180||e[0]<-180||e[1]>90||e[1]<-90)){var t=e[0],r=e[1];if(!v(t,r)){var a=g(t,r);t-=a[0],r-=a[1]}var n=[];return n.push(t),n.push(r),n}console.warn(o+"Error: Longitude range: -180 to 180, latitude range: -90 to 90")},A.prototype.translate_4326_to_gcj02=function(e){if(!(e[0]>180||e[0]<-180||e[1]>90||e[1]<-90)){var t=e[0],r=e[1];if(!v(t,r)){var a=g(t,r);t-=a[0],r-=a[1]}var n=[];return n.push(t),n.push(r),n}console.warn(o+"Error: Longitude range: -180 to 180, latitude range: -90 to 90")},A.prototype.translate_4326_to_bd09=function(e){if(!(e[0]>180||e[0]<-180||e[1]>90||e[1]<-90)){var t=this.translate_4326_to_gcj02(e);return this.translate_gcj02_to_bd09(t)}console.warn(o+"Error: Longitude range: -180 to 180, latitude range: -90 to 90")},A.prototype.translate_bd09_to_4326=function(e){if(!(e[0]>180||e[0]<-180||e[1]>90||e[1]<-90)){var t=this.translate_bd09_to_gcj02(e);return this.translate_gcj02_to_4326(t)}console.warn(o+"Error: Longitude range: -180 to 180, latitude range: -90 to 90")},A.prototype.getDistance=function(e,t){var o=new ol.Sphere(6378137).haversineDistance(e,t);return o=Math.round(100*o)/100},A.prototype.destroy=function(){for(var e=0;e<this.eventKey.length;e++)this._map.unByKey(this.eventKey[e]);this._map.getInteractions().clear();for(var t=this._map.getLayers(),o=0;o<t.getLength();o++)t.item(o).getSource().clear&&t.item(o).getSource().clear();t.clear(),delete hdmap.mapManager[this.getMapUid()]},A.prototype.clearMap=function(){for(var e in B.getLayerMap())this.removeCountMarkers(e);for(var t in this.areaTimer)clearInterval(this.areaTimer[t]);for(var o in this.lineTimer)clearInterval(this.lineTimer[o])},A.prototype.changeZoom=function(){this._map.getView().on("change:resolution",function(e){return this.getZoom()})},A.prototype.createNode=function(e,t,o,r,a){return(e=document.createElement(t)).setAttribute(o,r),a&&e.classList.add(a),e},A.prototype.toggleClassName=function(e,t,o){e.classList?(e.classList.remove(t),e.classList.add(o)):(e.className=e.className.replace(new RegExp("(^|\\b)"+t.split(" ").join("|")+"(\\b|$)","gi")," "),e.className+=" "+o)},A.prototype.popupShowNum=function(){var e=0;for(var t in this._overlays)this._overlays[t].show&&e++;return e},A.prototype.closeSinglePopup=function(e){this._overlays[e].show=!1,this._overlays[e].setPosition(void 0),D.curPopNum=this.popupShowNum(),D.reset()},A.prototype.closeTypePopup=function(e){for(var t in this._overlays)this._overlays[t].type===e&&(this._overlays[t].show=!1,this._overlays[t].setPosition(void 0));D.curPopNum=this.popupShowNum(),D.reset()},A.prototype.transfromWGSToBitMap=function(e){if(e[0]>180||e[0]<-180||e[1]>90||e[1]<-90)return console.warn(o+"Error: Longitude range: -180 to 180, latitude range: -90 to 90"),null;if(1===this.mapConfig.scaleType||"1"===this.mapConfig.scaleType){var t=this.translate_4326_to_3857(e),r=this.translate_4326_to_3857(this.mapConfig.centerGPS);if(!r)return void console.warn(o+"centerGPS of this map error");var a=(t[0]-r[0])/this.mapConfig.scale,n=(t[1]-r[1])/this.mapConfig.scale,i=Math.sqrt(Math.pow(a,2)+Math.pow(n,2)),s=Math.atan2(n,a)-this.mapConfig.arcAngle,l=[];return l[0]=i*Math.cos(s),l[1]=i*Math.sin(s),l}return console.warn(o+"ScaleType must equal 1"),null},A.prototype.transBitmapToWGS=function(e){if("1"===this.mapConfig.scaleType||1===this.mapConfig.scaleType){var t=this.translate_4326_to_3857(this.mapConfig.centerGPS);if(t){var r=function(e,t,o,r){var a=Math.atan2(e[1],e[0])+r,n=Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)),i=[];return i[0]=t[0]+n*Math.cos(a)*o,i[1]=t[1]+n*Math.sin(a)*o,i}(e,t,this.mapConfig.scale,this.mapConfig.arcAngle);return this.translate_3857_to_4326(r)}console.warn(o+"centerGPS of this map error")}else console.warn(o+"this map cannot translate XYZ to GPS")},A.prototype.getDistanceByMarker=function(e,t){if(1===this.mapConfig.scaleType||"1"===this.mapConfig.scaleType){var r=this.transBitmapToWGS(e),a=this.transBitmapToWGS(t);return this.getDistance(r,a)}if(2===this.mapConfig.scaleType){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))/this.mapConfig.scale}return console.warn(o+"ScaleType is error"),null},A.prototype.addWarnPopup=function(e,t){if(document.getElementById(e.id))console.warn(o+"node is already save");else{var r=e&&e.color?e.color:"danger"===e.type?"255,165,0":"255,0,0",a=this.createNode("wrapperDomObject","div","id",e.id,"hdmap-warn-pop");a.innerText=e.text||"报警事件",a.style.backgroundColor="rgb("+r+")";var n=this.createNode("arrow","div","id",e.domId+"-arrow","hdmap-warn-pop-arrow");n.style.borderRightColor="rgb("+r+")",a.appendChild(n),document.body.appendChild(a),t&&"function"==typeof t&&(a.onclick=t);var i=new ol.Overlay({});i.setElement(a),this._warnOverlays[e.id]=i,this.getMap().addOverlay(i),this._warnOverlays[e.id].setPosition(e.position)}},A.prototype.warnMarkerStart=function(e,t){var o=e&&e.color?e.color:"danger"===e.type?"255,165,0":"255,0,0",r=B.getLayerKeyByType("warnMarker"),a=this.getLayerByKey(r);void 0!==a&&null!==a||(a=this.addLayerByLayerKey(r)),a.setZIndex(999);var n=Z(e,r,"out"),i=Z(e,r,"in"),s=Z(e,r);s.setStyle(O(10,"rgba("+o+",1)")),a.getSource().getFeatureById(e.id)||(a.getSource().addFeature(s),a.getSource().addFeature(i),a.getSource().addFeature(n));var l=0;return this._map.on("postcompose",function(){(l+=.4)<10?(n.setStyle(O(0,"rgba("+o+",0.3)")),i.setStyle(O(0,"rgba("+o+",0.5)"))):l<20&&l>=10?i.setStyle(O(15,"rgba("+o+",0.5)")):l<30&&l>=20?n.setStyle(O(20,"rgba("+o+",0.3)")):l>=30&&(l=0,n.setStyle(O(0,"rgba("+o+",0.3)")),i.setStyle(O(0,"rgba("+o+",0.5)")))}),t&&"function"==typeof t?this.addWarnPopup(e,t):this.addWarnPopup(e),s},A.prototype.warnMarkerCancel=function(e){this.removeMarkerBylayerKey(e.id+"in","warnMarkerLayer"),this.removeMarkerBylayerKey(e.id+"out","warnMarkerLayer"),this.removeMarkerBylayerKey(e.id,"warnMarkerLayer"),this.getMap().removeOverlay(this._warnOverlays[e.id])},A.prototype.updateWarnMarker=function(e){if(e.id){var t=this.getMarkerBylayerKey(e.id,"warnMarkerLayer"),r=this.getMarkerBylayerKey(e.id+"in","warnMarkerLayer"),a=this.getMarkerBylayerKey(e.id+"out","warnMarkerLayer");if(t){var n=t.getExtProperties();this.copyAttr(n,e),e.position&&(t.getGeometry().setCoordinates(e.position),r.getGeometry().setCoordinates(e.position),a.getGeometry().setCoordinates(e.position),this._warnOverlays[e.id].setPosition(e.position))}else console.warn(o+"This point does not exist")}else console.warn(o+"markerId can not be empty")};function Z(e,t,o){var r=new ol.DevFeature({geometry:new ol.geom.Point(e.position),name:e.markerName,population:4e3,rainfall:500},e,t);return o?r.setId(e.id+o):r.setId(e.id),r}function O(e,t){return new ol.style.Style({image:new ol.style.Circle({radius:e,fill:new ol.style.Fill({color:t})})})}A.prototype.addWarningPopup=function(e){if(document.getElementById(e.id))console.warn("node is already save");else{var t,o=e.type?e.type:"danger",r=e.text?e.text:"预警事件",a=this.createNode("wrapperDomObject","div","id",e.id,"hdmap-warning-popup-wrap");t="warn"===o?'<div class="hdmap-popup-warn"></div><div class="hdmap-warn-pop">'+r+'<div class="hdmap-warn-pop-arrow"></div></div>':'<div class="hdmap-popup-danger"></div><div class="hdmap-danger-pop">'+r+'<div class="hdmap-danger-pop-arrow"></div></div>',a.innerHTML=t,document.body.appendChild(a);var n=this;a.onclick=function(t){n.eventCallback.singleclick.default.call(this,{feature:e,eventType:"singleclick",coordinate:e.position,layerKey:null,mapEvent:{originalEvent:t}})};var i=new ol.Overlay({});i.setElement(a),this._warnOverlays[e.id]=i,this.getMap().addOverlay(i),this._warnOverlays[e.id].setPosition(e.position)}},A.prototype.addWarningPopupRe=function(e){if(document.getElementById(e.id))console.warn("node is already save");else{var t=[],o=e.type?e.type:"danger";0===e.textList.length?t.push({text:"预警事件",count:1}):t=e.textList;var r,a=this.createNode("wrapperDomObject","div","id",e.id,"hdmap-warning-popup-wrap");if("warn"===o){r='<div class="hdmap-popup-warn"></div><div class="hdmap-warn-pop">';for(var n=0;n<t.length;n++){var i=t[n];0!==i.count&&(r+='<div class="hdmap-warn-pop-textBox-warn">'+(1===i.count?i.text:i.text+"("+i.count+")")+"</div>")}r+='<div class="hdmap-warn-pop-arrow"></div></div>'}else{r='<div class="hdmap-popup-danger"></div><div class="hdmap-danger-pop">';for(var s=0;s<t.length;s++){var l=t[s];0!==l.count&&(r+='<div class="hdmap-warn-pop-textBox-danger">'+(1===l.count?l.text:l.text+"("+l.count+")")+"</div>")}r+='<div class="hdmap-danger-pop-arrow"></div></div>'}a.innerHTML=r,document.body.appendChild(a);var p=this;a.onclick=function(t){p.eventCallback.singleclick.default.call(this,{feature:e,eventType:"singleclick",coordinate:e.position,layerKey:null,mapEvent:{originalEvent:t}})};var u=new ol.Overlay({});u.setElement(a),this._warnOverlays[e.id]=u,this.getMap().addOverlay(u),this._warnOverlays[e.id].setPosition(e.position)}},A.prototype.addViewPopup=function(e,t,o){var r=this;r.removeViewPopup(),t&&(z=setTimeout(function(){r.removeViewPopup()},t));var a,n=e.text?e.text:"未命名",i=this.createNode("wrapperDomObject","div","id","hdmapView","hdmap-view-popup-wrap");if(a='<div class="hdmap-view-pop">'+n+'<div class="hdmap-view-pop-arrow"></div></div>',i.innerHTML=a,document.body.appendChild(i),o&&o.backgroundColor){var s=i.querySelector(".hdmap-view-pop"),l=i.querySelector(".hdmap-view-pop-arrow");s.style.backgroundColor=o.backgroundColor,l.style.backgroundColor=o.backgroundColor}var p=new ol.Overlay({});p.setElement(i),this._viewOverlay=p,this.getMap().addOverlay(p),this._viewOverlay.setPosition(e.position)},A.prototype.removeWarningPopup=function(e){this.getMap().removeOverlay(this._warnOverlays[e])},A.prototype.removeViewPopup=function(e){clearTimeout(z),z=null,this.getMap().removeOverlay(this._viewOverlay)},A.prototype.clearWarningPopup=function(){for(var e in this._warnOverlays)this.getMap().removeOverlay(this._warnOverlays[e])},A.prototype.isInTileMapViewArea=function(e,t){if("tile"!==this.mapConfig.gisEngine)return!0;if(t&&!(e=this.transfromWGSToBitMap(e)))return console.warn(o+" can not translate GPS to position"),!1;var r=this.mapConfig.viewRange;return e[0]>=r.minX&&e[0]<=r.maxX&&e[1]>=r.minY&&e[1]<=r.maxY};function G(e,t,r){if(!(t[0]>180||t[0]<-180||t[1]>90||t[1]<-90||r[0]>180||r[0]<-180||r[1]>90||r[1]<-90)){return e.getDistance(t,r)}console.warn(o+"Error: Longitude range: -180 to 180, latitude range: -90 to 90")}function W(e){for(var t=0,o=[],r=0,a=0,n=1;n<=e.length;n++){var i=e[n%e.length][0],s=e[n%e.length][1],l=e[n-1][0],p=e[n-1][1],u=(i*p-s*l)/2;t+=u,r+=u*(i+l)/3,a+=u*(s+p)/3}return r/=t,a/=t,o[0]=r,o[1]=a,o}function N(e){for(var t=[0,0],o=0;o<e.length;o++)t[0]+=e[o][0],t[1]+=e[o][1];return t[0]=t[0]/3,t[1]=t[1]/3,t}function V(e){for(var t=[],o=[],r=[],a=0;a<e.length;a++){var n=Math.abs(e[a][0]),i=Math.abs(e[a][1]);o.push(n),r.push(i)}var s=Math.min.apply(null,o),l=Math.min.apply(null,r),p=Math.abs(W(e)[0]),u=Math.abs(W(e)[1]);return t[0]=Math.abs(s-p)/2,t[1]=Math.abs(l-u)/2,t}function j(e,t,o){o.push(t);var r=N(o),a=X(r,e);return"in"===a||"on"===a?r:(o.pop(),j(e,r,o))}function X(e,t){if(e instanceof Array&&2===e.length){return function(e,t){for(var o=!1,r=0,a=t.length,n=a-1;r<a;n=r,r++){if(t[r][0]===e[0]&&t[r][1]===e[1]||t[n][0]===e[0]&&t[n][1]===e[1])return"on";if(t[r][1]<e[1]&&t[n][1]>=e[1]||t[r][1]>=e[1]&&t[n][1]<e[1]){var i=t[r][0]+(e[1]-t[r][1])*(t[n][0]-t[r][0])/(t[n][1]-t[r][1]);if(i===e[0])return"on";i>e[0]&&(o=!o)}}return o?"in":"out"}(e,t)}return console.warn("点位越界传参有误： position must be a array && position.length === 2"),null}function R(e){for(var t=[],o=0,r=0,a=0;a<e.length;a++)o+=e[a][0],r+=e[a][1];return t[0]=o/e.length,t[1]=r/e.length,t}function U(e,t,o,r){var a=(r[0]-o[0])*(t[0]-o[0])+(r[1]-o[1])*(t[1]-o[1]),n=Math.pow(r[0]-o[0],2)+Math.pow(r[1]-o[1],2),i=e.transBitmapToWGS(t),s=e.transBitmapToWGS(o),l=e.transBitmapToWGS(r);if(a<=0)return G(e,i,s);if(a>=n)return G(e,i,l);var p=a/n,u=o[0]+(r[0]-o[0])*p,c=o[1]+(r[1]-o[1])*p;return G(e,i,e.transBitmapToWGS([u,c]))}function Y(e,t,o){for(var r in t)if(t[r][0]>180||t[r][0]<-180||t[r][1]>90||t[r][1]<-90)return console.warn("Error: Longitude range: -180 to 180, latitude range: -90 to 90"),null;function a(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}var n=o.pointA,i=o.pointB,s=o.pointC,l=e.translate_4326_to_3857(t.lonlatA),p=e.translate_4326_to_3857(t.lonlatB),u=e.translate_4326_to_3857(t.lonlatC);return(a(l,p)/a(n,i)+a(l,u)/a(n,s)+a(p,u)/a(i,s))/3}function q(e,t,o){for(var r in t)if(t[r][0]>180||t[r][0]<-180||t[r][1]>90||t[r][1]<-90)return console.warn("Error: Longitude range: -180 to 180, latitude range: -90 to 90"),null;function a(e,t,o,r){var a=Math.atan2(e[1],e[0])+r,n=Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)),i=[];return i[0]=t[0]-n*Math.cos(a)*o,i[1]=t[1]-n*Math.sin(a)*o,i}var n=o.pointA,i=o.pointB,s=o.pointC,l=Y(e,t,o),p=H(e,t,o),u=e.translate_4326_to_3857(t.lonlatA),c=e.translate_4326_to_3857(t.lonlatB),h=e.translate_4326_to_3857(t.lonlatC),d=e.translate_3857_to_4326(a(n,u,l,p)),y=e.translate_3857_to_4326(a(i,c,l,p)),f=e.translate_3857_to_4326(a(s,h,l,p));return[(d[0]+y[0]+f[0])/3,(d[1]+y[1]+f[1])/3]}function H(e,t,o){for(var r in t)if(t[r][0]>180||t[r][0]<-180||t[r][1]>90||t[r][1]<-90)return console.warn("Error: Longitude range: -180 to 180, latitude range: -90 to 90"),null;function a(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])}var n=o.pointA,i=o.pointB,s=o.pointC,l=e.translate_4326_to_3857(t.lonlatA),p=e.translate_4326_to_3857(t.lonlatB),u=e.translate_4326_to_3857(t.lonlatC),c=a(p,l)-a(i,n),h=a(u,l)-a(s,n),d=a(u,p)-a(s,i);Math.abs(h-c)>Math.PI&&(h=h>c?h-2*Math.PI:h+2*Math.PI),Math.abs(d-c)>Math.PI&&(d=d>c?d-2*Math.PI:d+2*Math.PI);return((c+h+d)/3+2*Math.PI)%(2*Math.PI)}var $={outOfChina:v,getDistanceByGPS:G,getScaleByGPS:Y,getCenterGPS:q,getScaleBySize:function(e,t,o,r){return(e/o+t/r)/2},getAreaCenter:W,getTrianglePoint:N,getMinDistance:V,getCameraCountPoint:function(e){var t=[],o=W(e)[0]-V(e)[0],r=W(e)[1];t[0]=o,t[1]=r;var a=X(t,e);if("on"===a||"in"===a)return t;var n=e.slice(0,2);return t=j(e,e[2],n)},getBroadcastCountPoint:function(e){var t=[],o=W(e)[0]+V(e)[0],r=W(e)[1];t[0]=o,t[1]=r;var a=X(t,e);if("on"===a||"in"===a)return t;var n=e.slice(1,3);return t=j(e,e[3],n)},getWarningConutPoint:function(e){var t=[],o=W(e)[0],r=W(e)[1]-V(e)[1];t[0]=o,t[1]=r;var a=X(t,e);if("on"===a||"in"===a)return t;var n=[];return 4===e.length?(n[0]=e[2],n[1]=e[3],t=j(e,e[0],n)):(n=e.slice(2,4),t=j(e,e[3],n)),t},judgePointInsidePolygon:X,getFeaturesInExtent:function(e,t){var o,r;if("tile"===e.mapConfig.gisEngine)r=1===(o=e.getMap().getView().getResolution())?32:64*Math.log2(o);else{var a=e.getZoom();r=24/Math.pow(2,a-3)}var n=[t[0]-r,t[1]-r,t[0]+r,t[1]+r],i=e.getOutterLayers(),s=[],l=[];for(var p in i)if(i[p].getVisible()){var u=i[p].getSource().getFeaturesInExtent(n);s.push(u)}for(var c=s.filter(function(e){return 0!==e.length}),h=0;h<c.length;h++)for(var d=c[h],y=0;y<d.length;y++){var f=d[y];f.extProperties&&f.extProperties.markerType&&(f.extProperties.layerkey=f.getLayerKey(),l.push(f.extProperties))}return l},getGeometryCenter:R,getWarningPosition:function(e){var t=[];return t[0]=(e.borderPoints[0][0]+e.borderPoints[1][0])/2,t[1]=(e.borderPoints[0][1]+e.borderPoints[1][1])/2,t},getParkingCoordinates:function(e){var t=[],o=[],r=[],a=[],n=[],i=[];return r[0]=e[0]-20,r[1]=e[1]+40,o.push(r),a[0]=e[0]+20,a[1]=e[1]+40,o.push(a),n[0]=e[0]+20,n[1]=e[1]-40,o.push(n),i[0]=e[0]-20,i[1]=e[1]-40,o.push(i),o.push(r),t.push(o),t},getParkingLockPoint:function(e,t){var o=[],r=function(e){var t=Math.pow(e[0][1][0]-e[0][2][0],2),o=Math.pow(e[0][1][1]-e[0][2][1],2);return Math.sqrt(t+o)}(e),a=null;if(5===e[0].length?(e[0].pop(),a=e[0]):a=e[0],0===t||360===t||-360===t)o[0]=R(a)[0],o[1]=R(a)[1]-r/3;else if(-90===t||270===t)o[0]=R(a)[0]+r/3,o[1]=R(a)[1];else if(90===t||-270===t)o[0]=R(a)[0]-r/3,o[1]=R(a)[1];else if(180===t||-180===t)o[0]=R(a)[0],o[1]=R(a)[1]+r/3;else{var n=[];n[0]=(a[0][0]+a[1][0])/2,n[1]=(a[0][1]+a[1][1])/2;var i=[];i[0]=(a[2][0]+a[3][0])/2,i[1]=(a[2][1]+a[3][1])/2,o[0]=n[0]-5*(n[0]-i[0])/6,o[1]=n[1]-5*(n[1]-i[1])/6}return o},pointToPolyline:function(e,t,o){if(!(t instanceof Array&&2===t.length))return console.warn("point must be a array & point.length === 2"),null;var r=U(e,t,o[0],o[1]);if(2===o.length)return r;if(o.length>2)for(var a=1;a<o.length-1;a++){var n=U(e,t,o[a],o[a+1]);return r=r<n?r:n}},judgePolygonsOverlap:function(e,t){function o(e,t){var o=(e[0][0]-t[0][0])*(e[1][1]-t[0][1])-(e[0][1]-t[0][1])*(e[1][0]-t[0][0]),r=(e[0][0]-t[1][0])*(e[1][1]-t[1][1])-(e[0][1]-t[1][1])*(e[1][0]-t[1][0]);if(o*r>=0)return!1;var a=(t[0][0]-e[0][0])*(t[1][1]-e[0][1])-(t[0][1]-e[0][1])*(t[1][0]-e[0][0]);return!(a*(a+o-r)>=0)}return function(e,t){for(var r=0,a=e.length;r<a;r++)for(var n=0,i=t.length;n<i;n++)if(o([e[r],e[r===a-1?0:r+1]],[t[n],t[n===i-1?0:n+1]]))return!0;return!1}(e,t)||function(e,t){for(var o=0;o<e.length;o++)if("out"!==hdmap.utils.judgePointInsidePolygon(e[o],t))return!0;for(var r=0;r<t.length;r++)if("out"!==hdmap.utils.judgePointInsidePolygon(t[r],e))return!0;return!1}(e,t)},getArcAngle:H,getMapProperty:function(e,t,o){var r={};return r.centerGPS=q(e,t,o),r.scale=Y(e,t,o),r.arcAngle=H(e,t,o),r},getVisibleAreaCenter:function(e){var t=e.getMap().getView().calculateExtent(e.getMap().getSize());return ol.extent.getCenter(t)},pointTransboundary:function(e,t,o){return e.getMarkerBylayerKey(t,"gisLayer").getGeometry().intersectsCoordinate(o)}};goog.provide("ol.layer.HDVector"),goog.provide("ol.DevFeature"),goog.provide("ol.AreaFeature"),goog.provide("ol.LineFeature"),goog.provide("ol.CountFeature"),goog.require("ol"),goog.require("ol.layer.Vector"),goog.require("ol.Feature"),ol.layer.HDVector=function(e,t){var o=t||{},r=ol.obj.assign({},o);ol.layer.Vector.call(this,r),this.layerKey=e,this.visibleFlag=!0},ol.inherits(ol.layer.HDVector,ol.layer.Vector),ol.layer.HDVector.prototype.getLayerKey=function(){return this.layerKey},ol.layer.HDVector.prototype.getVisibleFlag=function(){return this.visibleFlag},ol.layer.HDVector.prototype.setVisibleFlag=function(e){this.visibleFlag=e},ol.DevFeature=function(e,t,o){var r=e||{},a=ol.obj.assign({},r);ol.Feature.call(this,a),this.extProperties=t,this.layerKey=o},ol.inherits(ol.DevFeature,ol.Feature),ol.DevFeature.prototype.getExtProperties=function(){return this.extProperties},ol.DevFeature.prototype.setExtProperties=function(e){this.extProperties=e},ol.DevFeature.prototype.getLayerKey=function(){return this.layerKey},ol.DevFeature.prototype.setLayerKey=function(e){this.layerKey=e},ol.AreaFeature=function(e,t,o){var r=e||{},a=ol.obj.assign({},r);ol.Feature.call(this,a),this.extProperties=t,this.layerKey=o,this.rotate=t.rotate?t.rotate:0,this.areaTypesOf=t.areaTypesOf?t.areaTypesOf:"",this.originId=t.originId?t.originId:0},ol.inherits(ol.AreaFeature,ol.Feature),ol.AreaFeature.prototype.getExtProperties=function(){return this.extProperties},ol.AreaFeature.prototype.setExtProperties=function(e){this.extProperties=e},ol.AreaFeature.prototype.getLayerKey=function(){return this.layerKey},ol.AreaFeature.prototype.setLayerKey=function(e){this.layerKey=e},ol.AreaFeature.prototype.getAreaTypesOf=function(){return this.areaTypesOf},ol.AreaFeature.prototype.setAreaTypesOf=function(e){this.areaTypesOf=e},ol.AreaFeature.prototype.getRotate=function(){return this.rotate},ol.AreaFeature.prototype.setRotate=function(e){e>360?e%=360:e<-360&&(e%=-360),this.rotate=e,this.extProperties.rotate=e},ol.AreaFeature.prototype.getOriginId=function(){return this.originId},ol.AreaFeature.prototype.setOriginId=function(e){this.originId=e},ol.LineFeature=function(e,t,o){var r=e||{},a=ol.obj.assign({},r);ol.Feature.call(this,a),this.extProperties=t,this.layerKey=o},ol.inherits(ol.LineFeature,ol.Feature),ol.LineFeature.prototype.getExtProperties=function(){return this.extProperties},ol.LineFeature.prototype.setExtProperties=function(e){this.extProperties=e},ol.LineFeature.prototype.getLayerKey=function(){return this.layerKey},ol.LineFeature.prototype.setLayerKey=function(e){this.layerKey=e},ol.CountFeature=function(e,t,o){var r=e||{},a=ol.obj.assign({},r);ol.Feature.call(this,a),this.extProperties=t,this.layerKey=o},ol.inherits(ol.CountFeature,ol.Feature),ol.CountFeature.prototype.getExtProperties=function(){return this.extProperties},ol.CountFeature.prototype.setExtProperties=function(e){this.extProperties=e},ol.CountFeature.prototype.getLayerKey=function(){return this.layerKey},ol.CountFeature.prototype.setLayerKey=function(e){this.layerKey=e},ol.interaction.Transform=function(e){e||(e={});var t=this;this.handles_=new ol.Collection,this.overlayLayer_=new ol.layer.Vector({source:new ol.source.Vector({features:this.handles_,useSpatialIndex:!1}),name:"Transform overlay",displayInLayerSwitcher:!1,style:function(e){return t.style[(e.get("handle")||"default")+(e.get("constraint")||"")+(e.get("option")||"")]}}),ol.interaction.Pointer.call(this,{handleDownEvent:this.handleDownEvent_,handleDragEvent:this.handleDragEvent_,handleMoveEvent:this.handleMoveEvent_,handleUpEvent:this.handleUpEvent_}),this.features_=e.features,this.layers_=e.layers?e.layers instanceof Array?e.layers:[e.layers]:null,this.set("translateFeature",!1!==e.translateFeature),this.set("translate",!1!==e.translate),this.set("stretch",!1!==e.stretch),this.set("scale",!1!==e.scale),this.set("rotate",!1!==e.rotate),this.set("keepAspectRatio",e.keepAspectRatio||function(e){return e.originalEvent.shiftKey}),this.on("propertychange",function(){this.drawSketch_()}),this.setDefaultStyle()},ol.inherits(ol.interaction.Transform,ol.interaction.Pointer),ol.interaction.Transform.prototype.Cursors={default:"auto",select:"pointer",translate:"move",rotate:"move",scale:"ne-resize",scale1:"nw-resize",scale2:"ne-resize",scale3:"nw-resize",scalev:"e-resize",scaleh1:"n-resize",scalev2:"e-resize",scaleh3:"n-resize"},ol.interaction.Transform.prototype.setMap=function(e){e||(this.feature_=null),this.getMap()&&this.getMap().removeLayer(this.overlayLayer_),ol.interaction.Pointer.prototype.setMap.call(this,e),this.overlayLayer_.setMap(e),null!==e&&(this.isTouch=/touch/.test(e.getViewport().className),this.setDefaultStyle())},ol.interaction.Transform.prototype.setActive=function(e){this.select(null),this.overlayLayer_.setVisible(e),ol.interaction.Pointer.prototype.setActive.call(this,e)},ol.interaction.Transform.prototype.setDefaultStyle=function(){var e=new ol.style.Stroke({color:[255,0,0,1],width:1}),t=new ol.style.Stroke({color:[255,0,0,1],width:1,lineDash:[4,4]}),o=new ol.style.Fill({color:[255,0,0,.01]}),r=new ol.style.Fill({color:[255,255,255,.8]}),a=new ol.style.RegularShape({fill:r,stroke:e,radius:this.isTouch?12:6,points:15});a.getAnchor()[0]=this.isTouch?-10:-5;var n=new ol.style.RegularShape({fill:r,stroke:e,radius:this.isTouch?16:8,points:4,angle:Math.PI/4}),i=new ol.style.RegularShape({fill:r,stroke:e,radius:this.isTouch?12:6,points:4,angle:Math.PI/4});function s(e,t,o){return[new ol.style.Style({image:e,stroke:t,fill:o})]}this.style={default:s(n,t,o),translate:s(n,e,r),rotate:s(a,e,r),rotate0:s(n,e,r),scale:s(n,e,r),scale1:s(n,e,r),scale2:s(n,e,r),scale3:s(n,e,r),scalev:s(i,e,r),scaleh1:s(i,e,r),scalev2:s(i,e,r),scaleh3:s(i,e,r)},this.drawSketch_()},ol.interaction.Transform.prototype.setStyle=function(e,t){if(t){t instanceof Array?this.style[e]=t:this.style[e]=[t];for(var o=0;o<this.style[e].length;o++){var r=this.style[e][o].getImage();r&&("rotate"===e&&(r.getAnchor()[0]=-5),this.isTouch&&r.setScale(1.8));var a=this.style[e][o].getText();a&&("rotate"===e&&a.setOffsetX(this.isTouch?14:7),this.isTouch&&a.setScale(1.8))}this.drawSketch_()}},ol.interaction.Transform.prototype.getFeatureAtPixel_=function(e){var t=this;return this.getMap().forEachFeatureAtPixel(e,function(e,o){var r=!1;if(!o){if(e===t.bbox_)return!1;if(t.handles_.forEach(function(t){t===e&&(r=!0)}),r)return{feature:e,handle:e.get("handle"),constraint:e.get("constraint"),option:e.get("option")}}if(t.layers_){for(var a=0;a<t.layers_.length;a++)if(t.layers_[a]===o)return{feature:e};return null}return t.features_?(t.features_.forEach(function(t){t===e&&(r=!0)}),r?{feature:e}:null):{feature:e}})||{}},ol.interaction.Transform.prototype.drawSketch_=function(e){if(this.overlayLayer_.getSource().clear(),this.feature_)if(!0===e){if(!this.ispt_){this.overlayLayer_.getSource().addFeature(new ol.Feature({geometry:new ol.geom.Point(this.center_),handle:"rotate0"}));var t=this.feature_.getGeometry().getExtent(),o=ol.geom.Polygon.fromExtent(t),r=this.bbox_=new ol.Feature(o);this.overlayLayer_.getSource().addFeature(r)}}else{var a=this.feature_.getGeometry().getExtent();if(this.ispt_){var n=this.getMap().getPixelFromCoordinate([a[0],a[1]]);a=ol.extent.boundingExtent([this.getMap().getCoordinateFromPixel([n[0]-10,n[1]-10]),this.getMap().getCoordinateFromPixel([n[0]+10,n[1]+10])])}var i=ol.geom.Polygon.fromExtent(a),s=this.bbox_=new ol.Feature(i),l=[],p=i.getCoordinates()[0];if(!this.ispt_){l.push(s);var u=0;if(this.get("stretch")&&this.get("scale"))for(u=0;u<p.length-1;u++)s=new ol.Feature({geometry:new ol.geom.Point([(p[u][0]+p[u+1][0])/2,(p[u][1]+p[u+1][1])/2]),handle:"scale",constraint:u%2?"h":"v",option:u}),l.push(s);if(this.get("scale"))for(u=0;u<p.length-1;u++)s=new ol.Feature({geometry:new ol.geom.Point(p[u]),handle:"scale",option:u}),l.push(s);this.get("translate")&&!this.get("translateFeature")&&(s=new ol.Feature({geometry:new ol.geom.Point([(p[0][0]+p[2][0])/2,(p[0][1]+p[2][1])/2]),handle:"translate"}),l.push(s))}this.get("rotate")&&(s=new ol.Feature({geometry:new ol.geom.Point(p[3]),handle:"rotate"}),l.push(s)),this.overlayLayer_.getSource().addFeatures(l)}},ol.interaction.Transform.prototype.select=function(e){this.feature_=e,this.ispt_=!!this.feature_&&"Point"===this.feature_.getGeometry().getType(),this.drawSketch_(),this.dispatchEvent({type:"select",feature:this.feature_})},ol.interaction.Transform.prototype.handleDownEvent_=function(e){var t=this.getFeatureAtPixel_(e.pixel),o=t.feature;return this.feature_&&this.feature_===o&&(this.ispt_&&this.get("translate")||this.get("translateFeature"))&&(t.handle="translate"),t.handle?(this.mode_=t.handle,this.opt_=t.option,this.constraint_=t.constraint,this.coordinate_=e.coordinate,this.pixel_=e.pixel,this.geom_=this.feature_.getGeometry().clone(),this.extent_=ol.geom.Polygon.fromExtent(this.geom_.getExtent()).getCoordinates()[0],this.center_=ol.extent.getCenter(this.geom_.getExtent()),this.angle_=Math.atan2(this.center_[1]-e.coordinate[1],this.center_[0]-e.coordinate[0]),this.dispatchEvent({type:this.mode_+"start",feature:this.feature_,pixel:e.pixel,coordinate:e.coordinate}),!0):(this.feature_=o,this.ispt_=!!this.feature_&&"Point"===this.feature_.getGeometry().getType(),this.drawSketch_(),this.dispatchEvent({type:"select",feature:this.feature_,pixel:e.pixel,coordinate:e.coordinate}),!1)},ol.interaction.Transform.prototype.handleDragEvent_=function(e){switch(this.mode_){case"rotate":var t=Math.atan2(this.center_[1]-e.coordinate[1],this.center_[0]-e.coordinate[0]);if(!this.ispt){var o=this.geom_.clone();o.rotate(t-this.angle_,this.center_),this.feature_.setGeometry(o),this.feature_.set("angle",t-this.angle_)}this.drawSketch_(!0),this.dispatchEvent({type:"rotating",feature:this.feature_,angle:t-this.angle_,pixel:e.pixel,coordinate:e.coordinate});break;case"translate":var r=e.coordinate[0]-this.coordinate_[0],a=e.coordinate[1]-this.coordinate_[1];this.feature_.getGeometry().translate(r,a),this.handles_.forEach(function(e){e.getGeometry().translate(r,a)}),this.coordinate_=e.coordinate,this.dispatchEvent({type:"translating",feature:this.feature_,delta:[r,a],pixel:e.pixel,coordinate:e.coordinate});break;case"scale":var n=this.center_;(e.originalEvent.metaKey||e.originalEvent.ctrlKey)&&(n=this.extent_[(Number(this.opt_)+2)%4]);var i=(e.coordinate[0]-n[0])/(this.coordinate_[0]-n[0]),s=(e.coordinate[1]-n[1])/(this.coordinate_[1]-n[1]);this.constraint_?"h"===this.constraint_?i=1:s=1:this.get("keepAspectRatio")(e)&&(i=s=Math.min(i,s));var l=0,p=this.geom_.clone();p.applyTransform(function(e,t,o){if(o<2)return t;for(l=0;l<e.length;l+=o)1!==i&&(t[l]=n[0]+(e[l]-n[0])*i),1!==s&&(t[l+1]=n[1]+(e[l+1]-n[1])*s);return t}),this.feature_.setGeometry(p),this.drawSketch_(),this.dispatchEvent({type:"scaling",feature:this.feature_,scale:[i,s],pixel:e.pixel,coordinate:e.coordinate})}},ol.interaction.Transform.prototype.handleMoveEvent_=function(e){if(!this.mode_){var t=this.getFeatureAtPixel_(e.pixel),o=e.map.getTargetElement();if(t.feature){var r=t.handle?this.Cursors[(t.handle||"default")+(t.constraint||"")+(t.option||"")]:this.Cursors.select;void 0===this.previousCursor_&&(this.previousCursor_=o.style.cursor),o.style.cursor=r}else void 0!==this.previousCursor_&&(o.style.cursor=this.previousCursor_),this.previousCursor_=void 0}},ol.interaction.Transform.prototype.handleUpEvent_=function(e){return this.dispatchEvent({type:this.mode_+"end",feature:this.feature_,oldgeom:this.geom_}),this.drawSketch_(),this.mode_=null,!1};var J={initMap:A,utils:$,mapManager:{},commonConfig:function(){var e={cameraLayer:{zindex:8},videoLayer:{zindex:8},guarderLayer:{zindex:8},cleanerLayer:{zindex:8},carLayer:{zindex:8},warningLayer:{zindex:11},commonLayer:{zindex:8},gisLayer:{zindex:10},lineLayer:{zindex:10},fenceLayer:{zindex:11},countCameraLayer:{zindex:10},countWarningLayer:{zindex:10},countBroadcastLayer:{zindex:10},cameraBase:{zindex:9},warningBase:{zindex:9},broadcastBase:{zindex:9},robotLayer:{zindex:12},signpostLayer:{zindex:12},broadcastLayer:{zindex:9},markerWarnLayer:{zindex:12},households:{zindex:9},visitor:{zindex:9},stranger:{zindex:9},control:{zindex:9},brake:{zindex:9},gates:{zindex:9},elevator:{zindex:9},lock:{zindex:9}},t=function(e){var t=e?e.color:"#7740dc";return new ol.style.Style({stroke:new ol.style.Stroke({color:t,width:8})})},o=function(){return new ol.style.Style({stroke:new ol.style.Stroke({color:"#f39826",width:8})})},r=function(){return new ol.style.Style({stroke:new ol.style.Stroke({color:"#ff0000",width:8})})};return{gisConfig:{mapType:"baidu",mapUrl:"http://online1.map.bdimg.com/onlinelabel/?qt=tile&x={x}&y={y}&z={z}&styles=pl&p=1&scaler=1&udt=20171115",mapSatUrl:"http://shangetu1.map.bdimg.com/it/u=x={x};y={y};z={z};v=009;type=sate&fm=46&app=webearth2&v=009&udt=20171115",SatUrl:"http://online1.map.bdimg.com/onlinelabel/?qt=tile&x={x}&y={y}&z={z}&styles=sl&p=1&scaler=1&udt=20171115",center:[116.40348,39.923758]},getMouseOverAreaStyle:function(e){var t=e&&e.fillColor?e.fillColor:"rgba(100,149,237,0.2)",o=e&&e.strokeColor?e.strokeColor:"#1E90FF",r=e&&e.strokeWidth?e.strokeWidth:2;return new ol.style.Style({fill:new ol.style.Fill({color:t}),stroke:new ol.style.Stroke({color:o,width:r,lineDash:[5,10]})})},getFeatureStyle:function(e,t){var o=t&&t.color?t.color:"white",r=t&&t.scale?t.scale:1,a=t&&t.opacity?t.opacity:1,n=t&&t.rotation?t.rotation:0,i=t&&t.anchor?t.anchor:[.5,1];return new ol.style.Style({image:new ol.style.Icon({src:e.imgUrl,size:e.size,color:o,opacity:a,scale:r,rotation:n,anchor:i})})},getWarningAreaStyle:function(e){return new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255,0,0,"+e+")"}),stroke:new ol.style.Stroke({color:"red",width:2,lineDash:[5,10]})})},getCountCameraFeatureStyle:function(e,t){var o,r,a,n;switch(e.cameraNum.length){case 1:o=t&&t.offsetX?t.offsetX:9,r=t&&t.offsetY?t.offsetY:-2,a=t&&t.anchor?t.anchor:[.9,.7],n="15px bold Calibri,sans-serif";break;case 2:o=t&&t.offsetX?t.offsetX:9,r=t&&t.offsetY?t.offsetY:-2,a=t&&t.anchor?t.anchor:[1.1,.7],n="13px bold Calibri,sans-serif";break;case 3:o=t&&t.offsetX?t.offsetX:8,r=t&&t.offsetY?t.offsetY:-2,a=t&&t.anchor?t.anchor:[1.4,.7],n="13px bold Calibri,sans-serif"}return new ol.style.Style({image:new ol.style.Icon({src:e.url,color:"white",scale:t&&t.scale?t.scale:.8,anchor:a}),text:new ol.style.Text({text:e.cameraNum,font:n,fill:new ol.style.Fill({color:"white"}),offsetX:o,offsetY:r})})},getCountWarningFeatureStyle:function(e,t){var o,r,a,n;switch(e.warnNum.length){case 1:o=t&&t.offsetX?t.offsetX:8,r=t&&t.offsetY?t.offsetY:-2,a=t&&t.anchor?t.anchor:[.9,.7],n="15px bold Calibri,sans-serif";break;case 2:o=t&&t.offsetX?t.offsetX:8,r=t&&t.offsetY?t.offsetY:-2,a=t&&t.anchor?t.anchor:[1.1,.7],n="13px bold Calibri,sans-serif";break;case 3:o=t&&t.offsetX?t.offsetX:8,r=t&&t.offsetY?t.offsetY:-2,a=t&&t.anchor?t.anchor:[1.4,.7],n="13px bold Calibri,sans-serif"}return new ol.style.Style({image:new ol.style.Icon({src:e.url,color:"white",scale:t&&t.scale?t.scale:.8,anchor:a}),text:new ol.style.Text({text:e.warnNum,font:n,fill:new ol.style.Fill({color:"white"}),offsetX:o,offsetY:r})})},getCountBroadcastFeatureStyle:function(e,t){var o,r,a,n;switch(e.broadcastNum.length){case 1:o=t&&t.offsetX?t.offsetX:8,r=t&&t.offsetY?t.offsetY:-2,a=t&&t.anchor?t.anchor:[1.1,.7],n="15px bold Calibri,sans-serif";break;case 2:o=t&&t.offsetX?t.offsetX:8,r=t&&t.offsetY?t.offsetY:-2,a=t&&t.anchor?t.anchor:[1.1,.7],n="13px bold Calibri,sans-serif";break;case 3:o=t&&t.offsetX?t.offsetX:8,r=t&&t.offsetY?t.offsetY:-2,a=t&&t.anchor?t.anchor:[1.4,.7],n="12px bold Calibri,sans-serif"}return new ol.style.Style({image:new ol.style.Icon({src:e.url,color:"white",scale:t&&t.scale?t.scale:.8,anchor:a}),text:new ol.style.Text({text:e.broadcastNum,font:n,fill:new ol.style.Fill({color:"white"}),offsetX:o,offsetY:r})})},getCountDefaultStyle:function(e){var t;return e.cameraNum&&(t=e.cameraNum.length<3?1:1.1),e.broadcastNum&&(t=e.broadcastNum.length<3?1:1.1),new ol.style.Style({image:new ol.style.Icon({src:e.baseUrl,size:[45,42],scale:t,offset:[0,0]})})},getCountWarningStyle:function(e){var t=e.warnNum.length<3?1:1.1;return new ol.style.Style({image:new ol.style.Icon({src:e.baseUrl,size:[45,42],scale:t,offset:[0,0]})})},setAreaStyle:function(e){var t=e&&e.fillColor?e.fillColor:"rgba(0,0,0,0)",o=e&&e.strokeColor?e.strokeColor:"rgba(0,0,0,0)",r=e&&e.strokeWidth?e.strokeWidth:"2",a=e&&e.lineDash?e.lineDash:[5,10],n=e&&e.rotation?e.rotation:0;return new ol.style.Style({fill:new ol.style.Fill({color:t}),stroke:new ol.style.Stroke({color:o,width:r,lineDash:a,rotation:n})})},getNormalRouteStyle:t,getOfflineRouteStyle:o,getWarningRouteStyle:r,getRouteStyleAnimation:function(e,t){var a=e.lineTimer[t.id];void 0===a||null===a?a=t.id:clearInterval(a);var n=0,i=setInterval(function(){var a;a=++n%2==0?r():o(),e.updateLine(t,a)},500);e.lineTimer[t.id]=i},warnRouteCancel:function(e,o,r){var a=e.lineTimer[o.id];a&&(clearInterval(a),r?e.updateLine(o,t(r)):e.updateLine(o,t()))},getLayerZindex:function(t){return e[t]}}}()};return window.hdmap=J,J});